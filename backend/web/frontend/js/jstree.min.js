(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof module!=="undefined"&&module.exports){module.exports=a(require("jquery"))}else{a(jQuery)}}}(function(a,q){
/*
     * jsTree 3.1.1
     * http://jstree.com/
     *
     * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
     *
     * Licensed same as jquery - under the terms of the MIT License
     *   http://www.opensource.org/licenses/mit-license.php
     */
/*
     * if using jslint please allow for the jQuery global and use following options:
     * jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
     */
if(a.jstree){}var l=0,h=false,g=false,f=false,o=[],n=a("script:last").attr("src"),j=window.document,c=j.createElement("LI"),d,e;c.setAttribute("role","treeitem");d=j.createElement("I");d.className="jstree-icon jstree-ocl";d.setAttribute("role","presentation");c.appendChild(d);d=j.createElement("A");d.className="jstree-anchor";d.setAttribute("href","#");d.setAttribute("tabindex","-1");e=j.createElement("I");e.className="jstree-icon jstree-themeicon";e.setAttribute("role","presentation");d.appendChild(e);c.appendChild(d);d=e=null;a.jstree={version:"3.1.1",defaults:{plugins:[]},plugins:{},path:n&&n.indexOf("/")!==-1?n.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g};a.jstree.create=function(r,t){var u=new a.jstree.core(++l),s=t;t=a.extend(true,{},a.jstree.defaults,t);if(s&&s.plugins){t.plugins=s.plugins}a.each(t.plugins,function(v,w){if(v!=="core"){u=u.plugin(w,t[w])}});a(r).data("jstree",u);u.init(r,t);return u};a.jstree.destroy=function(){a(".jstree:jstree").jstree("destroy");a(j).off(".jstree")};a.jstree.core=function(r){this._id=r;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:false,dots:false,icons:false},selected:[],last_error:{},working:false,worker_queue:[],focused:null}}};a.jstree.reference=function(s){var u=null,t=null;if(s&&s.id&&(!s.tagName||!s.nodeType)){s=s.id}if(!t||!t.length){try{t=a(s)}catch(r){}}if(!t||!t.length){try{t=a("#"+s.replace(a.jstree.idregex,"\\$&"))}catch(r){}}if(t&&t.length&&(t=t.closest(".jstree")).length&&(t=t.data("jstree"))){u=t}else{a(".jstree").each(function(){var v=a(this).data("jstree");if(v&&v._model.data[s]){u=v;return false}})}return u};a.fn.jstree=function(r){var t=(typeof r==="string"),s=Array.prototype.slice.call(arguments,1),u=null;if(r===true&&!this.length){return false}this.each(function(){var v=a.jstree.reference(this),w=t&&v?v[r]:null;u=t&&w?w.apply(v,s):null;if(!v&&!t&&(r===q||a.isPlainObject(r))){a.jstree.create(this,r)}if((v&&!t)||r===true){u=v||false}if(u!==null&&u!==q){return false}});return u!==null&&u!==q?u:this};a.expr[":"].jstree=a.expr.createPseudo(function(r){return function(s){return a(s).hasClass("jstree")&&a(s).data("jstree")!==q}});a.jstree.defaults.core={data:false,strings:false,check_callback:false,error:a.noop,animation:200,multiple:true,themes:{name:false,url:false,dir:false,dots:true,icons:true,stripes:false,variant:false,responsive:false},expand_selected_onload:true,worker:true,force_text:false,dblclick_toggle:true};a.jstree.core.prototype={plugin:function(s,t){var r=a.jstree.plugins[s];if(r){this._data[s]={};r.prototype=this;return new r(t,this)}return this},init:function(r,s){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}},changed:[],force_full_redraw:false,redraw_timeout:false,default_state:{loaded:true,opened:false,selected:false,disabled:false}};this.element=a(r).addClass("jstree jstree-"+this._id);this.settings=s;this._data.core.ready=false;this._data.core.loaded=false;this._data.core.rtl=(this.element.css("direction")==="rtl");this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");if(this.settings.core.multiple){this.element.attr("aria-multiselectable",true)}if(!this.element.attr("tabindex")){this.element.attr("tabindex","0")}this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(true);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||24;this.trigger("loading");this.load_node("#")},destroy:function(s){if(this._wrk){try{window.URL.revokeObjectURL(this._wrk);this._wrk=null}catch(r){}}if(!s){this.element.empty()}this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var t="",r=null,s=0;this.element.on("dblclick.jstree",function(u){if(u.target.tagName&&u.target.tagName.toLowerCase()==="input"){return true}if(j.selection&&j.selection.empty){j.selection.empty()}else{if(window.getSelection){var w=window.getSelection();try{w.removeAllRanges();w.collapse()}catch(v){}}}}).on("mousedown.jstree",a.proxy(function(u){if(u.target===this.element[0]){u.preventDefault();s=+(new Date())}},this)).on("mousedown.jstree",".jstree-ocl",function(u){u.preventDefault()}).on("click.jstree",".jstree-ocl",a.proxy(function(u){this.toggle_node(u.target)},this)).on("dblclick.jstree",".jstree-anchor",a.proxy(function(u){if(u.target.tagName&&u.target.tagName.toLowerCase()==="input"){return true}if(this.settings.core.dblclick_toggle){this.toggle_node(u.target)}},this)).on("click.jstree",".jstree-anchor",a.proxy(function(u){u.preventDefault();if(u.currentTarget!==j.activeElement){a(u.currentTarget).focus()}this.activate_node(u.currentTarget,u)},this)).on("keydown.jstree",".jstree-anchor",a.proxy(function(u){if(u.target.tagName&&u.target.tagName.toLowerCase()==="input"){return true}if(u.which!==32&&u.which!==13&&(u.shiftKey||u.ctrlKey||u.altKey||u.metaKey)){return true}var v=null;if(this._data.core.rtl){if(u.which===37){u.which=39}else{if(u.which===39){u.which=37}}}switch(u.which){case 32:if(u.ctrlKey){u.type="click";a(u.currentTarget).trigger(u)}break;case 13:u.type="click";a(u.currentTarget).trigger(u);break;case 37:u.preventDefault();if(this.is_open(u.currentTarget)){this.close_node(u.currentTarget)}else{v=this.get_parent(u.currentTarget);if(v&&v.id!=="#"){this.get_node(v,true).children(".jstree-anchor").focus()}}break;case 38:u.preventDefault();v=this.get_prev_dom(u.currentTarget);if(v&&v.length){v.children(".jstree-anchor").focus()}break;case 39:u.preventDefault();if(this.is_closed(u.currentTarget)){this.open_node(u.currentTarget,function(w){this.get_node(w,true).children(".jstree-anchor").focus()})}else{if(this.is_open(u.currentTarget)){v=this.get_node(u.currentTarget,true).children(".jstree-children")[0];if(v){a(this._firstChild(v)).children(".jstree-anchor").focus()}}}break;case 40:u.preventDefault();v=this.get_next_dom(u.currentTarget);if(v&&v.length){v.children(".jstree-anchor").focus()}break;case 106:this.open_all();break;case 36:u.preventDefault();v=this._firstChild(this.get_container_ul()[0]);if(v){a(v).children(".jstree-anchor").filter(":visible").focus()}break;case 35:u.preventDefault();this.element.find(".jstree-anchor").filter(":visible").last().focus();break}},this)).on("load_node.jstree",a.proxy(function(v,u){if(u.status){if(u.node.id==="#"&&!this._data.core.loaded){this._data.core.loaded=true;if(this._firstChild(this.get_container_ul()[0])){this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id)}this.trigger("loaded")}if(!this._data.core.ready){setTimeout(a.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=true;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var y=[],w,x;for(w=0,x=this._data.core.selected.length;w<x;w++){y=y.concat(this._model.data[this._data.core.selected[w]].parents)}y=a.vakata.array_unique(y);for(w=0,x=y.length;w<x;w++){this.open_node(y[w],false,0)}}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0)}}},this)).on("keypress.jstree",a.proxy(function(w){if(w.target.tagName&&w.target.tagName.toLowerCase()==="input"){return true}if(r){clearTimeout(r)}r=setTimeout(function(){t=""},500);var u=String.fromCharCode(w.which).toLowerCase(),v=this.element.find(".jstree-anchor").filter(":visible"),y=v.index(j.activeElement)||0,x=false;t+=u;if(t.length>1){v.slice(y).each(a.proxy(function(z,A){if(a(A).text().toLowerCase().indexOf(t)===0){a(A).focus();x=true;return false}},this));if(x){return}v.slice(0,y).each(a.proxy(function(z,A){if(a(A).text().toLowerCase().indexOf(t)===0){a(A).focus();x=true;return false}},this));if(x){return}}if(new RegExp("^"+u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){v.slice(y+1).each(a.proxy(function(z,A){if(a(A).text().toLowerCase().charAt(0)===u){a(A).focus();x=true;return false}},this));if(x){return}v.slice(0,y+1).each(a.proxy(function(z,A){if(a(A).text().toLowerCase().charAt(0)===u){a(A).focus();x=true;return false}},this));if(x){return}}},this)).on("init.jstree",a.proxy(function(){var u=this.settings.core.themes;this._data.core.themes.dots=u.dots;this._data.core.themes.stripes=u.stripes;this._data.core.themes.icons=u.icons;this.set_theme(u.name||"default",u.url);this.set_theme_variant(u.variant)},this)).on("loading.jstree",a.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",a.proxy(function(u){this._data.core.focused=null;a(u.currentTarget).filter(".jstree-hovered").mouseleave();this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",a.proxy(function(u){var v=this.get_node(u.currentTarget);if(v&&v.id){this._data.core.focused=v.id}this.element.find(".jstree-hovered").not(u.currentTarget).mouseleave();a(u.currentTarget).mouseenter();this.element.attr("tabindex","-1")},this)).on("focus.jstree",a.proxy(function(){if(+(new Date())-s>500&&!this._data.core.focused){s=0;var u=this.get_node(this.element.attr("aria-activedescendant"),true);if(u){u.find("> .jstree-anchor").focus()}}},this)).on("mouseenter.jstree",".jstree-anchor",a.proxy(function(u){this.hover_node(u.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",a.proxy(function(u){this.dehover_node(u.currentTarget)},this))},unbind:function(){this.element.off(".jstree");a(j).off(".jstree-"+this._id)},trigger:function(s,r){if(!r){r={}}r.instance=this;this.element.triggerHandler(s.replace(".jstree","")+".jstree",r)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(s){var r=this.settings.core.strings;if(a.isFunction(r)){return r.call(this,s)}if(r&&r[s]){return r[s]}return s},_firstChild:function(r){r=r?r.firstChild:null;while(r!==null&&r.nodeType!==1){r=r.nextSibling}return r},_nextSibling:function(r){r=r?r.nextSibling:null;while(r!==null&&r.nodeType!==1){r=r.nextSibling}return r},_previousSibling:function(r){r=r?r.previousSibling:null;while(r!==null&&r.nodeType!==1){r=r.previousSibling}return r},get_node:function(u,r){if(u&&u.id){u=u.id}var s;try{if(this._model.data[u]){u=this._model.data[u]}else{if(typeof u==="string"&&this._model.data[u.replace(/^#/,"")]){u=this._model.data[u.replace(/^#/,"")]}else{if(typeof u==="string"&&(s=a("#"+u.replace(a.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[s.closest(".jstree-node").attr("id")]){u=this._model.data[s.closest(".jstree-node").attr("id")]}else{if((s=a(u,this.element)).length&&this._model.data[s.closest(".jstree-node").attr("id")]){u=this._model.data[s.closest(".jstree-node").attr("id")]}else{if((s=a(u,this.element)).length&&s.hasClass("jstree")){u=this._model.data["#"]}else{return false}}}}}if(r){u=u.id==="#"?this.element:a("#"+u.id.replace(a.jstree.idregex,"\\$&"),this.element)}return u}catch(t){return false}},get_path:function(v,r,t){v=v.parents?v:this.get_node(v);if(!v||v.id==="#"||!v.parents){return false}var s,u,w=[];w.push(t?v.id:v.text);for(s=0,u=v.parents.length;s<u;s++){w.push(t?v.parents[s]:this.get_text(v.parents[s]))}w=w.reverse().slice(1);return r?w.join(r):w},get_next_dom:function(r,s){var t;r=this.get_node(r,true);if(r[0]===this.element[0]){t=this._firstChild(this.get_container_ul()[0]);while(t&&t.offsetHeight===0){t=this._nextSibling(t)}return t?a(t):false}if(!r||!r.length){return false}if(s){t=r[0];do{t=this._nextSibling(t)}while(t&&t.offsetHeight===0);return t?a(t):false}if(r.hasClass("jstree-open")){t=this._firstChild(r.children(".jstree-children")[0]);while(t&&t.offsetHeight===0){t=this._nextSibling(t)}if(t!==null){return a(t)}}t=r[0];do{t=this._nextSibling(t)}while(t&&t.offsetHeight===0);if(t!==null){return a(t)}return r.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(r,s){var t;r=this.get_node(r,true);if(r[0]===this.element[0]){t=this.get_container_ul()[0].lastChild;while(t&&t.offsetHeight===0){t=this._previousSibling(t)}return t?a(t):false}if(!r||!r.length){return false}if(s){t=r[0];do{t=this._previousSibling(t)}while(t&&t.offsetHeight===0);return t?a(t):false}t=r[0];do{t=this._previousSibling(t)}while(t&&t.offsetHeight===0);if(t!==null){r=a(t);while(r.hasClass("jstree-open")){r=r.children(".jstree-children").first().children(".jstree-node:visible:last")}return r}t=r[0].parentNode.parentNode;return t&&t.className&&t.className.indexOf("jstree-node")!==-1?a(t):false},get_parent:function(r){r=this.get_node(r);if(!r||r.id==="#"){return false}return r.parent},get_children_dom:function(r){r=this.get_node(r,true);if(r[0]===this.element[0]){return this.get_container_ul().children(".jstree-node")}if(!r||!r.length){return false}return r.children(".jstree-children").children(".jstree-node")},is_parent:function(r){r=this.get_node(r);return r&&(r.state.loaded===false||r.children.length>0)},is_loaded:function(r){r=this.get_node(r);return r&&r.state.loaded},is_loading:function(r){r=this.get_node(r);return r&&r.state&&r.state.loading},is_open:function(r){r=this.get_node(r);return r&&r.state.opened},is_closed:function(r){r=this.get_node(r);return r&&this.is_parent(r)&&!r.state.opened},is_leaf:function(r){return !this.is_parent(r)},load_node:function(x,s){var v,w,t,u,r;if(a.isArray(x)){this._load_nodes(x.slice(),s);return true}x=this.get_node(x);if(!x){if(s){s.call(this,x,false)}return false}if(x.state.loaded){x.state.loaded=false;for(v=0,w=x.children_d.length;v<w;v++){for(t=0,u=x.parents.length;t<u;t++){this._model.data[x.parents[t]].children_d=a.vakata.array_remove_item(this._model.data[x.parents[t]].children_d,x.children_d[v])}if(this._model.data[x.children_d[v]].state.selected){r=true;this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,x.children_d[v])}delete this._model.data[x.children_d[v]]}x.children=[];x.children_d=[];if(r){this.trigger("changed",{action:"load_node",node:x,selected:this._data.core.selected})}}x.state.failed=false;x.state.loading=true;this.get_node(x,true).addClass("jstree-loading").attr("aria-busy",true);this._load_node(x,a.proxy(function(z){x=this._model.data[x.id];x.state.loading=false;x.state.loaded=z;x.state.failed=!x.state.loaded;var y=this.get_node(x,true);if(x.state.loaded&&!x.children.length&&y&&y.length&&!y.hasClass("jstree-leaf")){y.removeClass("jstree-closed jstree-open").addClass("jstree-leaf")}y.removeClass("jstree-loading").attr("aria-busy",false);this.trigger("load_node",{node:x,status:z});if(s){s.call(this,x,z)}},this));return true},_load_nodes:function(y,t,v){var z=true,s=function(){this._load_nodes(y,t,true)},x=this._model.data,u,w,A=[];for(u=0,w=y.length;u<w;u++){if(x[y[u]]&&((!x[y[u]].state.loaded&&!x[y[u]].state.failed)||!v)){if(!this.is_loading(y[u])){this.load_node(y[u],s)}z=false}}if(z){for(u=0,w=y.length;u<w;u++){if(x[y[u]]&&x[y[u]].state.loaded){A.push(y[u])}}if(t&&!t.done){t.call(this,A);t.done=true}}},load_all:function(w,s){if(!w){w="#"}w=this.get_node(w);if(!w){return false}var x=[],v=this._model.data,r=v[w.id].children_d,t,u;if(w.state&&!w.state.loaded){x.push(w.id)}for(t=0,u=r.length;t<u;t++){if(v[r[t]]&&v[r[t]].state&&!v[r[t]].state.loaded){x.push(r[t])}}if(x.length){this._load_nodes(x,function(){this.load_all(w,s)})}else{if(s){s.call(this,w)}this.trigger("load_all",{node:w})}},_load_node:function(u,r){var v=this.settings.core.data,w;if(!v){if(u.id==="#"){return this._append_html_data(u,this._data.core.original_container_html.clone(true),function(s){r.call(this,s)})}else{return r.call(this,false)}}if(a.isFunction(v)){return v.call(this,u,a.proxy(function(s){if(s===false){r.call(this,false)}this[typeof s==="string"?"_append_html_data":"_append_json_data"](u,typeof s==="string"?a(a.parseHTML(s)).filter(function(){return this.nodeType!==3}):s,function(t){r.call(this,t)})},this))}if(typeof v==="object"){if(v.url){v=a.extend(true,{},v);if(a.isFunction(v.url)){v.url=v.url.call(this,u)}if(a.isFunction(v.data)){v.data=v.data.call(this,u)}return a.ajax(v).done(a.proxy(function(s,y,A){var z=A.getResponseHeader("Content-Type");if((z&&z.indexOf("json")!==-1)||typeof s==="object"){return this._append_json_data(u,s,function(t){r.call(this,t)})}if((z&&z.indexOf("html")!==-1)||typeof s==="string"){return this._append_html_data(u,a(a.parseHTML(s)).filter(function(){return this.nodeType!==3}),function(t){r.call(this,t)})}this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:u.id,xhr:A})};this.settings.core.error.call(this,this._data.core.last_error);return r.call(this,false)},this)).fail(a.proxy(function(s){r.call(this,false);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:u.id,xhr:s})};this.settings.core.error.call(this,this._data.core.last_error)},this))}w=(a.isArray(v)||a.isPlainObject(v))?JSON.parse(JSON.stringify(v)):v;if(u.id==="#"){return this._append_json_data(u,w,function(s){r.call(this,s)})}else{this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:u.id})};this.settings.core.error.call(this,this._data.core.last_error);return r.call(this,false)}}if(typeof v==="string"){if(u.id==="#"){return this._append_html_data(u,a(a.parseHTML(v)).filter(function(){return this.nodeType!==3}),function(s){r.call(this,s)})}else{this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:u.id})};this.settings.core.error.call(this,this._data.core.last_error);return r.call(this,false)}}return r.call(this,false)},_node_changed:function(r){r=this.get_node(r);if(r){this._model.changed.push(r.id)}},_append_html_data:function(w,v,r){w=this.get_node(w);w.children=[];w.children_d=[];var u=v.is("ul")?v.children():v,C=w.id,t=[],x=[],A=this._model.data,B=A[C],D=this._data.core.selected.length,E,y,z;u.each(a.proxy(function(s,F){E=this._parse_model_from_html(a(F),C,B.parents.concat());if(E){t.push(E);x.push(E);if(A[E].children_d.length){x=x.concat(A[E].children_d)}}},this));B.children=t;B.children_d=x;for(y=0,z=B.parents.length;y<z;y++){A[B.parents[y]].children_d=A[B.parents[y]].children_d.concat(x)}this.trigger("model",{nodes:x,parent:C});if(C!=="#"){this._node_changed(C);this.redraw()}else{this.get_container_ul().children(".jstree-initial-node").remove();this.redraw(true)}if(this._data.core.selected.length!==D){this.trigger("changed",{action:"model",selected:this._data.core.selected})}r.call(this,true)},_append_json_data:function(u,t,s,x){if(this.element===null){return}u=this.get_node(u);u.children=[];u.children_d=[];if(t.d){t=t.d;if(typeof t==="string"){t=JSON.parse(t)}}if(!a.isArray(t)){t=[t]}var A=null,r={df:this._model.default_state,dat:t,par:u.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},y=function(D,S){if(D.data){D=D.data}var C=D.dat,K=D.par,B=[],F=[],w=[],E=D.df,Q=D.t_id,P=D.t_cnt,I=D.m,J=I[K],O=D.sel,R,G,H,N,L=function(U,Y,Z){if(!Z){Z=[]}else{Z=Z.concat()}if(Y){Z.unshift(Y)}var aa=U.id.toString(),W,X,T,V,ab={id:aa,text:U.text||"",icon:U.icon!==S?U.icon:true,parent:Y,parents:Z,children:U.children||[],children_d:U.children_d||[],data:U.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(W in E){if(E.hasOwnProperty(W)){ab.state[W]=E[W]}}if(U&&U.data&&U.data.jstree&&U.data.jstree.icon){ab.icon=U.data.jstree.icon}if(ab.icon===S||ab.icon===null||ab.icon===""){ab.icon=true}if(U&&U.data){ab.data=U.data;if(U.data.jstree){for(W in U.data.jstree){if(U.data.jstree.hasOwnProperty(W)){ab.state[W]=U.data.jstree[W]}}}}if(U&&typeof U.state==="object"){for(W in U.state){if(U.state.hasOwnProperty(W)){ab.state[W]=U.state[W]}}}if(U&&typeof U.li_attr==="object"){for(W in U.li_attr){if(U.li_attr.hasOwnProperty(W)){ab.li_attr[W]=U.li_attr[W]}}}if(!ab.li_attr.id){ab.li_attr.id=aa}if(U&&typeof U.a_attr==="object"){for(W in U.a_attr){if(U.a_attr.hasOwnProperty(W)){ab.a_attr[W]=U.a_attr[W]}}}if(U&&U.children&&U.children===true){ab.state.loaded=false;ab.children=[];ab.children_d=[]}I[ab.id]=ab;for(W=0,X=ab.children.length;W<X;W++){T=L(I[ab.children[W]],ab.id,Z);V=I[T];ab.children_d.push(T);if(V.children_d.length){ab.children_d=ab.children_d.concat(V.children_d)}}delete U.data;delete U.children;I[ab.id].original=U;if(ab.state.selected){w.push(ab.id)}return ab.id},M=function(U,Y,Z){if(!Z){Z=[]}else{Z=Z.concat()}if(Y){Z.unshift(Y)}var aa=false,W,X,T,V,ab;do{aa="j"+Q+"_"+(++P)}while(I[aa]);ab={id:false,text:typeof U==="string"?U:"",icon:typeof U==="object"&&U.icon!==S?U.icon:true,parent:Y,parents:Z,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(W in E){if(E.hasOwnProperty(W)){ab.state[W]=E[W]}}if(U&&U.id){ab.id=U.id.toString()}if(U&&U.text){ab.text=U.text}if(U&&U.data&&U.data.jstree&&U.data.jstree.icon){ab.icon=U.data.jstree.icon}if(ab.icon===S||ab.icon===null||ab.icon===""){ab.icon=true}if(U&&U.data){ab.data=U.data;if(U.data.jstree){for(W in U.data.jstree){if(U.data.jstree.hasOwnProperty(W)){ab.state[W]=U.data.jstree[W]}}}}if(U&&typeof U.state==="object"){for(W in U.state){if(U.state.hasOwnProperty(W)){ab.state[W]=U.state[W]}}}if(U&&typeof U.li_attr==="object"){for(W in U.li_attr){if(U.li_attr.hasOwnProperty(W)){ab.li_attr[W]=U.li_attr[W]}}}if(ab.li_attr.id&&!ab.id){ab.id=ab.li_attr.id.toString()}if(!ab.id){ab.id=aa}if(!ab.li_attr.id){ab.li_attr.id=ab.id}if(U&&typeof U.a_attr==="object"){for(W in U.a_attr){if(U.a_attr.hasOwnProperty(W)){ab.a_attr[W]=U.a_attr[W]}}}if(U&&U.children&&U.children.length){for(W=0,X=U.children.length;W<X;W++){T=M(U.children[W],ab.id,Z);V=I[T];ab.children.push(T);if(V.children_d.length){ab.children_d=ab.children_d.concat(V.children_d)}}ab.children_d=ab.children_d.concat(ab.children)}if(U&&U.children&&U.children===true){ab.state.loaded=false;ab.children=[];ab.children_d=[]}delete U.data;delete U.children;ab.original=U;I[ab.id]=ab;if(ab.state.selected){w.push(ab.id)}return ab.id};if(C.length&&C[0].id!==S&&C[0].parent!==S){for(G=0,H=C.length;G<H;G++){if(!C[G].children){C[G].children=[]}I[C[G].id.toString()]=C[G]}for(G=0,H=C.length;G<H;G++){I[C[G].parent.toString()].children.push(C[G].id.toString());J.children_d.push(C[G].id.toString())}for(G=0,H=J.children.length;G<H;G++){R=L(I[J.children[G]],K,J.parents.concat());F.push(R);if(I[R].children_d.length){F=F.concat(I[R].children_d)}}for(G=0,H=J.parents.length;G<H;G++){I[J.parents[G]].children_d=I[J.parents[G]].children_d.concat(F)}N={cnt:P,mod:I,sel:O,par:K,dpc:F,add:w}}else{for(G=0,H=C.length;G<H;G++){R=M(C[G],K,J.parents.concat());if(R){B.push(R);F.push(R);if(I[R].children_d.length){F=F.concat(I[R].children_d)}}}J.children=B;J.children_d=F;for(G=0,H=J.parents.length;G<H;G++){I[J.parents[G]].children_d=I[J.parents[G]].children_d.concat(F)}N={cnt:P,mod:I,sel:O,par:K,dpc:F,add:w}}if(typeof window==="undefined"||typeof window.document==="undefined"){postMessage(N)}else{return N}},z=function(F,H){if(this.element===null){return}this._cnt=F.cnt;this._model.data=F.mod;if(H){var B,C,w=F.add,E=F.sel,G=this._data.core.selected.slice(),D=this._model.data;if(E.length!==G.length||a.vakata.array_unique(E.concat(G)).length!==E.length){for(B=0,C=E.length;B<C;B++){if(a.inArray(E[B],w)===-1&&a.inArray(E[B],G)===-1){D[E[B]].state.selected=false}}for(B=0,C=G.length;B<C;B++){if(a.inArray(G[B],E)===-1){D[G[B]].state.selected=true}}}}if(F.add.length){this._data.core.selected=this._data.core.selected.concat(F.add)}this.trigger("model",{nodes:F.dpc,parent:F.par});if(F.par!=="#"){this._node_changed(F.par);this.redraw()}else{this.redraw(true)}if(F.add.length){this.trigger("changed",{action:"model",selected:this._data.core.selected})}s.call(this,true)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker){try{if(this._wrk===null){this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+y.toString()],{type:"text/javascript"}))}if(!this._data.core.working||x){this._data.core.working=true;A=new window.Worker(this._wrk);A.onmessage=a.proxy(function(w){z.call(this,w.data,true);try{A.terminate();A=null}catch(B){}if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}},this);if(!r.par){if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}}else{A.postMessage(r)}}else{this._data.core.worker_queue.push([u,t,s,true])}}catch(v){z.call(this,y(r),false);if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}}}else{z.call(this,y(r),false)}},_parse_model_from_html:function(s,x,y){if(!y){y=[]}else{y=[].concat(y)}if(x){y.unshift(x)}var r,u,w=this._model.data,t={id:false,text:false,icon:true,parent:x,parents:y,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false},v,A,z;for(v in this._model.default_state){if(this._model.default_state.hasOwnProperty(v)){t.state[v]=this._model.default_state[v]}}A=a.vakata.attributes(s,true);a.each(A,function(B,C){C=a.trim(C);if(!C.length){return true}t.li_attr[B]=C;if(B==="id"){t.id=C.toString()}});A=s.children("a").first();if(A.length){A=a.vakata.attributes(A,true);a.each(A,function(B,C){C=a.trim(C);if(C.length){t.a_attr[B]=C}})}A=s.children("a").first().length?s.children("a").first().clone():s.clone();A.children("ins, i, ul").remove();A=A.html();A=a("<div />").html(A);t.text=this.settings.core.force_text?A.text():A.html();A=s.data();t.data=A?a.extend(true,{},A):null;t.state.opened=s.hasClass("jstree-open");t.state.selected=s.children("a").hasClass("jstree-clicked");t.state.disabled=s.children("a").hasClass("jstree-disabled");if(t.data&&t.data.jstree){for(v in t.data.jstree){if(t.data.jstree.hasOwnProperty(v)){t.state[v]=t.data.jstree[v]}}}A=s.children("a").children(".jstree-themeicon");if(A.length){t.icon=A.hasClass("jstree-themeicon-hidden")?false:A.attr("rel")}if(t.state.icon!==q){t.icon=t.state.icon}if(t.icon===q||t.icon===null||t.icon===""){t.icon=true}A=s.children("ul").children("li");do{z="j"+this._id+"_"+(++this._cnt)}while(w[z]);t.id=t.li_attr.id?t.li_attr.id.toString():z;if(A.length){A.each(a.proxy(function(B,C){r=this._parse_model_from_html(a(C),t.id,y);u=this._model.data[r];t.children.push(r);if(u.children_d.length){t.children_d=t.children_d.concat(u.children_d)}},this));t.children_d=t.children_d.concat(t.children)}else{if(s.hasClass("jstree-closed")){t.state.loaded=false}}if(t.li_attr["class"]){t.li_attr["class"]=t.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")}if(t.a_attr["class"]){t.a_attr["class"]=t.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")}w[t.id]=t;if(t.state.selected){this._data.core.selected.push(t.id)}return t.id},_parse_model_from_flat_json:function(s,y,z){if(!z){z=[]}else{z=z.concat()}if(y){z.unshift(y)}var A=s.id.toString(),x=this._model.data,t=this._model.default_state,v,w,r,u,B={id:A,text:s.text||"",icon:s.icon!==q?s.icon:true,parent:y,parents:z,children:s.children||[],children_d:s.children_d||[],data:s.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(v in t){if(t.hasOwnProperty(v)){B.state[v]=t[v]}}if(s&&s.data&&s.data.jstree&&s.data.jstree.icon){B.icon=s.data.jstree.icon}if(B.icon===q||B.icon===null||B.icon===""){B.icon=true}if(s&&s.data){B.data=s.data;if(s.data.jstree){for(v in s.data.jstree){if(s.data.jstree.hasOwnProperty(v)){B.state[v]=s.data.jstree[v]}}}}if(s&&typeof s.state==="object"){for(v in s.state){if(s.state.hasOwnProperty(v)){B.state[v]=s.state[v]}}}if(s&&typeof s.li_attr==="object"){for(v in s.li_attr){if(s.li_attr.hasOwnProperty(v)){B.li_attr[v]=s.li_attr[v]}}}if(!B.li_attr.id){B.li_attr.id=A}if(s&&typeof s.a_attr==="object"){for(v in s.a_attr){if(s.a_attr.hasOwnProperty(v)){B.a_attr[v]=s.a_attr[v]}}}if(s&&s.children&&s.children===true){B.state.loaded=false;B.children=[];B.children_d=[]}x[B.id]=B;for(v=0,w=B.children.length;v<w;v++){r=this._parse_model_from_flat_json(x[B.children[v]],B.id,z);u=x[r];B.children_d.push(r);if(u.children_d.length){B.children_d=B.children_d.concat(u.children_d)}}delete s.data;delete s.children;x[B.id].original=s;if(B.state.selected){this._data.core.selected.push(B.id)}return B.id},_parse_model_from_json:function(s,y,z){if(!z){z=[]}else{z=z.concat()}if(y){z.unshift(y)}var A=false,v,w,r,u,x=this._model.data,t=this._model.default_state,B;do{A="j"+this._id+"_"+(++this._cnt)}while(x[A]);B={id:false,text:typeof s==="string"?s:"",icon:typeof s==="object"&&s.icon!==q?s.icon:true,parent:y,parents:z,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(v in t){if(t.hasOwnProperty(v)){B.state[v]=t[v]}}if(s&&s.id){B.id=s.id.toString()}if(s&&s.text){B.text=s.text}if(s&&s.data&&s.data.jstree&&s.data.jstree.icon){B.icon=s.data.jstree.icon}if(B.icon===q||B.icon===null||B.icon===""){B.icon=true}if(s&&s.data){B.data=s.data;if(s.data.jstree){for(v in s.data.jstree){if(s.data.jstree.hasOwnProperty(v)){B.state[v]=s.data.jstree[v]}}}}if(s&&typeof s.state==="object"){for(v in s.state){if(s.state.hasOwnProperty(v)){B.state[v]=s.state[v]}}}if(s&&typeof s.li_attr==="object"){for(v in s.li_attr){if(s.li_attr.hasOwnProperty(v)){B.li_attr[v]=s.li_attr[v]}}}if(B.li_attr.id&&!B.id){B.id=B.li_attr.id.toString()}if(!B.id){B.id=A}if(!B.li_attr.id){B.li_attr.id=B.id}if(s&&typeof s.a_attr==="object"){for(v in s.a_attr){if(s.a_attr.hasOwnProperty(v)){B.a_attr[v]=s.a_attr[v]}}}if(s&&s.children&&s.children.length){for(v=0,w=s.children.length;v<w;v++){r=this._parse_model_from_json(s.children[v],B.id,z);u=x[r];B.children.push(r);if(u.children_d.length){B.children_d=B.children_d.concat(u.children_d)}}B.children_d=B.children_d.concat(B.children)}if(s&&s.children&&s.children===true){B.state.loaded=false;B.children=[];B.children_d=[]}delete s.data;delete s.children;B.original=s;x[B.id]=B;if(B.state.selected){this._data.core.selected.push(B.id)}return B.id},_redraw:function(){var v=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),r=j.createElement("UL"),w,t,u,s=this._data.core.focused;for(t=0,u=v.length;t<u;t++){w=this.redraw_node(v[t],true,this._model.force_full_redraw);if(w&&this._model.force_full_redraw){r.appendChild(w)}}if(this._model.force_full_redraw){r.className=this.get_container_ul()[0].className;r.setAttribute("role","group");this.element.empty().append(r)}if(s!==null){w=this.get_node(s,true);if(w&&w.length&&w.children(".jstree-anchor")[0]!==j.activeElement){w.children(".jstree-anchor").focus()}else{this._data.core.focused=null}}this._model.force_full_redraw=false;this._model.changed=[];this.trigger("redraw",{nodes:v})},redraw:function(r){if(r){this._model.force_full_redraw=true}this._redraw()},draw_children:function(v){var w=this.get_node(v),s=false,t=false,u=false,r=j;if(!w){return false}if(w.id==="#"){return this.redraw(true)}v=this.get_node(v,true);if(!v||!v.length){return false}v.children(".jstree-children").remove();v=v[0];if(w.children.length&&w.state.loaded){u=r.createElement("UL");u.setAttribute("role","group");u.className="jstree-children";for(s=0,t=w.children.length;s<t;s++){u.appendChild(this.redraw_node(w.children[s],true,true))}v.appendChild(u)}},redraw_node:function(F,v,A,x){var G=this.get_node(F),I=false,z=false,H=false,y=false,B=false,C=false,r="",u=j,E=this._model.data,w=false,J=false,L=null,K=0,D=0;if(!G){return false}if(G.id==="#"){return this.redraw(true)}v=v||G.children.length===0;F=!j.querySelector?j.getElementById(G.id):this.element[0].querySelector("#"+("0123456789".indexOf(G.id[0])!==-1?"\\3"+G.id[0]+" "+G.id.substr(1).replace(a.jstree.idregex,"\\$&"):G.id.replace(a.jstree.idregex,"\\$&")));if(!F){v=true;if(!A){I=G.parent!=="#"?a("#"+G.parent.replace(a.jstree.idregex,"\\$&"),this.element)[0]:null;if(I!==null&&(!I||!E[G.parent].state.opened)){return false}z=a.inArray(G.id,I===null?E["#"].children:E[G.parent].children)}}else{F=a(F);if(!A){I=F.parent().parent()[0];if(I===this.element[0]){I=null}z=F.index()}if(!v&&G.children.length&&!F.children(".jstree-children").length){v=true}if(!v){H=F.children(".jstree-children")[0]}w=F.children(".jstree-anchor")[0]===j.activeElement;F.remove()}F=c.cloneNode(true);r="jstree-node ";for(y in G.li_attr){if(G.li_attr.hasOwnProperty(y)){if(y==="id"){continue}if(y!=="class"){F.setAttribute(y,G.li_attr[y])}else{r+=G.li_attr[y]}}}if(!G.a_attr.id){G.a_attr.id=G.id+"_anchor"}F.setAttribute("aria-selected",!!G.state.selected);F.setAttribute("aria-level",G.parents.length);F.setAttribute("aria-labelledby",G.a_attr.id);if(G.state.disabled){F.setAttribute("aria-disabled",true)}if(G.state.loaded&&!G.children.length){r+=" jstree-leaf"}else{r+=G.state.opened&&G.state.loaded?" jstree-open":" jstree-closed";F.setAttribute("aria-expanded",(G.state.opened&&G.state.loaded))}if(G.parent!==null&&E[G.parent].children[E[G.parent].children.length-1]===G.id){r+=" jstree-last"}F.id=G.id;F.className=r;r=(G.state.selected?" jstree-clicked":"")+(G.state.disabled?" jstree-disabled":"");for(B in G.a_attr){if(G.a_attr.hasOwnProperty(B)){if(B==="href"&&G.a_attr[B]==="#"){continue}if(B!=="class"){F.childNodes[1].setAttribute(B,G.a_attr[B])}else{r+=" "+G.a_attr[B]}}}if(r.length){F.childNodes[1].className="jstree-anchor "+r}if((G.icon&&G.icon!==true)||G.icon===false){if(G.icon===false){F.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden"}else{if(G.icon.indexOf("/")===-1&&G.icon.indexOf(".")===-1){F.childNodes[1].childNodes[0].className+=" "+G.icon+" jstree-themeicon-custom"}else{F.childNodes[1].childNodes[0].style.backgroundImage="url("+G.icon+")";F.childNodes[1].childNodes[0].style.backgroundPosition="center center";F.childNodes[1].childNodes[0].style.backgroundSize="auto";F.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom"}}}if(this.settings.core.force_text){F.childNodes[1].appendChild(u.createTextNode(G.text))}else{F.childNodes[1].innerHTML+=G.text}if(v&&G.children.length&&(G.state.opened||x)&&G.state.loaded){C=u.createElement("UL");C.setAttribute("role","group");C.className="jstree-children";for(y=0,B=G.children.length;y<B;y++){C.appendChild(this.redraw_node(G.children[y],v,true))}F.appendChild(C)}if(H){F.appendChild(H)}if(!A){if(!I){I=this.element[0]}for(y=0,B=I.childNodes.length;y<B;y++){if(I.childNodes[y]&&I.childNodes[y].className&&I.childNodes[y].className.indexOf("jstree-children")!==-1){L=I.childNodes[y];break}}if(!L){L=u.createElement("UL");L.setAttribute("role","group");L.className="jstree-children";I.appendChild(L)}I=L;if(z<I.childNodes.length){I.insertBefore(F,I.childNodes[z])}else{I.appendChild(F)}if(w){K=this.element[0].scrollTop;D=this.element[0].scrollLeft;F.childNodes[1].focus();this.element[0].scrollTop=K;this.element[0].scrollLeft=D}}if(G.state.opened&&!G.state.loaded){G.state.opened=false;setTimeout(a.proxy(function(){this.open_node(G.id,false,0)},this),0)}return F},open_node:function(v,s,r){var x,y,u,w;if(a.isArray(v)){v=v.slice();for(x=0,y=v.length;x<y;x++){this.open_node(v[x],s,r)}return true}v=this.get_node(v);if(!v||v.id==="#"){return false}r=r===q?this.settings.core.animation:r;if(!this.is_closed(v)){if(s){s.call(this,v,false)}return false}if(!this.is_loaded(v)){if(this.is_loading(v)){return setTimeout(a.proxy(function(){this.open_node(v,s,r)},this),500)}this.load_node(v,function(t,z){return z?this.open_node(t,s,r):(s?s.call(this,t,false):false)})}else{u=this.get_node(v,true);w=this;if(u.length){if(r&&u.children(".jstree-children").length){u.children(".jstree-children").stop(true,true)}if(v.children.length&&!this._firstChild(u.children(".jstree-children")[0])){this.draw_children(v)}if(!r){this.trigger("before_open",{node:v});u[0].className=u[0].className.replace("jstree-closed","jstree-open");u[0].setAttribute("aria-expanded",true)}else{this.trigger("before_open",{node:v});u.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",true).children(".jstree-children").stop(true,true).slideDown(r,function(){this.style.display="";w.trigger("after_open",{node:v})})}}v.state.opened=true;if(s){s.call(this,v,true)}if(!u.length){this.trigger("before_open",{node:v})}this.trigger("open_node",{node:v});if(!r||!u.length){this.trigger("after_open",{node:v})}}},_open_to:function(t){t=this.get_node(t);if(!t||t.id==="#"){return false}var r,s,u=t.parents;for(r=0,s=u.length;r<s;r+=1){if(r!=="#"){this.open_node(u[r],false,0)}}return a("#"+t.id.replace(a.jstree.idregex,"\\$&"),this.element)},close_node:function(u,r){var w,x,v,s;if(a.isArray(u)){u=u.slice();for(w=0,x=u.length;w<x;w++){this.close_node(u[w],r)}return true}u=this.get_node(u);if(!u||u.id==="#"){return false}if(this.is_closed(u)){return false}r=r===q?this.settings.core.animation:r;v=this;s=this.get_node(u,true);if(s.length){if(!r){s[0].className=s[0].className.replace("jstree-open","jstree-closed");s.attr("aria-expanded",false).children(".jstree-children").remove()}else{s.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",false).children(".jstree-children").stop(true,true).slideUp(r,function(){this.style.display="";s.children(".jstree-children").remove();v.trigger("after_close",{node:u})})}}u.state.opened=false;this.trigger("close_node",{node:u});if(!r||!s.length){this.trigger("after_close",{node:u})}},toggle_node:function(r){var s,t;if(a.isArray(r)){r=r.slice();for(s=0,t=r.length;s<t;s++){this.toggle_node(r[s])}return true}if(this.is_closed(r)){return this.open_node(r)}if(this.is_open(r)){return this.close_node(r)}},open_all:function(w,s,x){if(!w){w="#"}w=this.get_node(w);if(!w){return false}var t=w.id==="#"?this.get_container_ul():this.get_node(w,true),u,v,r;if(!t.length){for(u=0,v=w.children_d.length;u<v;u++){if(this.is_closed(this._model.data[w.children_d[u]])){this._model.data[w.children_d[u]].state.opened=true}}return this.trigger("open_all",{node:w})}x=x||t;r=this;t=this.is_closed(w)?t.find(".jstree-closed").addBack():t.find(".jstree-closed");t.each(function(){r.open_node(this,function(y,z){if(z&&this.is_parent(y)){this.open_all(y,s,x)}},s||0)});if(x.find(".jstree-closed").length===0){this.trigger("open_all",{node:this.get_node(x)})}},close_all:function(w,s){if(!w){w="#"}w=this.get_node(w);if(!w){return false}var t=w.id==="#"?this.get_container_ul():this.get_node(w,true),r=this,u,v;if(t.length){t=this.is_open(w)?t.find(".jstree-open").addBack():t.find(".jstree-open");a(t.get().reverse()).each(function(){r.close_node(this,s||0)})}for(u=0,v=w.children_d.length;u<v;u++){this._model.data[w.children_d[u]].state.opened=false}this.trigger("close_all",{node:w})},is_disabled:function(r){r=this.get_node(r);return r&&r.state&&r.state.disabled},enable_node:function(r){var s,t;if(a.isArray(r)){r=r.slice();for(s=0,t=r.length;s<t;s++){this.enable_node(r[s])}return true}r=this.get_node(r);if(!r||r.id==="#"){return false}r.state.disabled=false;this.get_node(r,true).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",false);this.trigger("enable_node",{node:r})},disable_node:function(r){var s,t;if(a.isArray(r)){r=r.slice();for(s=0,t=r.length;s<t;s++){this.disable_node(r[s])}return true}r=this.get_node(r);if(!r||r.id==="#"){return false}r.state.disabled=true;this.get_node(r,true).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",true);this.trigger("disable_node",{node:r})},activate_node:function(x,s){if(this.is_disabled(x)){return false}if(!s||typeof s!=="object"){s={}}this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==q?this.get_node(this._data.core.last_clicked.id):null;if(this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected){this._data.core.last_clicked=null}if(!this._data.core.last_clicked&&this._data.core.selected.length){this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])}if(!this.settings.core.multiple||(!s.metaKey&&!s.ctrlKey&&!s.shiftKey)||(s.shiftKey&&(!this._data.core.last_clicked||!this.get_parent(x)||this.get_parent(x)!==this._data.core.last_clicked.parent))){if(!this.settings.core.multiple&&(s.metaKey||s.ctrlKey||s.shiftKey)&&this.is_selected(x)){this.deselect_node(x,false,s)}else{this.deselect_all(true);this.select_node(x,false,false,s);this._data.core.last_clicked=this.get_node(x)}}else{if(s.shiftKey){var w=this.get_node(x).id,v=this._data.core.last_clicked.id,y=this.get_node(this._data.core.last_clicked.parent).children,r=false,t,u;for(t=0,u=y.length;t<u;t+=1){if(y[t]===w){r=!r}if(y[t]===v){r=!r}if(!this.is_disabled(y[t])&&(r||y[t]===w||y[t]===v)){this.select_node(y[t],true,false,s)}else{this.deselect_node(y[t],true,s)}}this.trigger("changed",{action:"select_node",node:this.get_node(x),selected:this._data.core.selected,event:s})}else{if(!this.is_selected(x)){this.select_node(x,false,false,s)}else{this.deselect_node(x,false,s)}}}this.trigger("activate_node",{node:this.get_node(x)})},hover_node:function(s){s=this.get_node(s,true);if(!s||!s.length||s.children(".jstree-hovered").length){return false}var r=this.element.find(".jstree-hovered"),u=this.element;if(r&&r.length){this.dehover_node(r)}s.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(s)});setTimeout(function(){u.attr("aria-activedescendant",s[0].id)},0)},dehover_node:function(r){r=this.get_node(r,true);if(!r||!r.length||!r.children(".jstree-hovered").length){return false}r.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(r)})},select_node:function(t,v,u,s){var r,w,x,y;if(a.isArray(t)){t=t.slice();for(w=0,x=t.length;w<x;w++){this.select_node(t[w],v,u,s)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}r=this.get_node(t,true);if(!t.state.selected){t.state.selected=true;this._data.core.selected.push(t.id);if(!u){r=this._open_to(t)}if(r&&r.length){r.attr("aria-selected",true).children(".jstree-anchor").addClass("jstree-clicked")}this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s});if(!v){this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s})}}},deselect_node:function(t,u,s){var v,w,r;if(a.isArray(t)){t=t.slice();for(v=0,w=t.length;v<w;v++){this.deselect_node(t[v],u,s)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}r=this.get_node(t,true);if(t.state.selected){t.state.selected=false;this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,t.id);if(r.length){r.attr("aria-selected",false).children(".jstree-anchor").removeClass("jstree-clicked")}this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:s});if(!u){this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:s})}}},select_all:function(t){var u=this._data.core.selected.concat([]),r,s;this._data.core.selected=this._model.data["#"].children_d.concat();for(r=0,s=this._data.core.selected.length;r<s;r++){if(this._model.data[this._data.core.selected[r]]){this._model.data[this._data.core.selected[r]].state.selected=true}}this.redraw(true);this.trigger("select_all",{selected:this._data.core.selected});if(!t){this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:u})}},deselect_all:function(t){var u=this._data.core.selected.concat([]),r,s;for(r=0,s=this._data.core.selected.length;r<s;r++){if(this._model.data[this._data.core.selected[r]]){this._model.data[this._data.core.selected[r]].state.selected=false}}this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",false);this.trigger("deselect_all",{selected:this._data.core.selected,node:u});if(!t){this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:u})}},is_selected:function(r){r=this.get_node(r);if(!r||r.id==="#"){return false}return r.state.selected},get_selected:function(r){return r?a.map(this._data.core.selected,a.proxy(function(s){return this.get_node(s)},this)):this._data.core.selected.slice()},get_top_selected:function(r){var x=this.get_selected(true),w={},s,t,u,v;for(s=0,t=x.length;s<t;s++){w[x[s].id]=x[s]}for(s=0,t=x.length;s<t;s++){for(u=0,v=x[s].children_d.length;u<v;u++){if(w[x[s].children_d[u]]){delete w[x[s].children_d[u]]}}}x=[];for(s in w){if(w.hasOwnProperty(s)){x.push(s)}}return r?a.map(x,a.proxy(function(y){return this.get_node(y)},this)):x},get_bottom_selected:function(r){var v=this.get_selected(true),u=[],s,t;for(s=0,t=v.length;s<t;s++){if(!v[s].children.length){u.push(v[s].id)}}return r?a.map(u,a.proxy(function(w){return this.get_node(w)},this)):u},get_state:function(){var s={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},
/*
                     'themes' : {
                     'name' : this.get_theme(),
                     'icons' : this._data.core.themes.icons,
                     'dots' : this._data.core.themes.dots
                     },
                     */
selected:[]}},r;for(r in this._model.data){if(this._model.data.hasOwnProperty(r)){if(r!=="#"){if(this._model.data[r].state.opened){s.core.open.push(r)}if(this._model.data[r].state.selected){s.core.selected.push(r)}}}}return s},set_state:function(x,s){if(x){if(x.core){var w,v,y,r,u;if(x.core.open){if(!a.isArray(x.core.open)||!x.core.open.length){delete x.core.open;this.set_state(x,s)}else{this._load_nodes(x.core.open,function(t){this.open_node(t,false,0);delete x.core.open;this.set_state(x,s)},true)}return false}if(x.core.scroll){if(x.core.scroll&&x.core.scroll.left!==q){this.element.scrollLeft(x.core.scroll.left)}if(x.core.scroll&&x.core.scroll.top!==q){this.element.scrollTop(x.core.scroll.top)}delete x.core.scroll;this.set_state(x,s);return false}if(x.core.selected){r=this;this.deselect_all();a.each(x.core.selected,function(t,z){r.select_node(z,false,true)});delete x.core.selected;this.set_state(x,s);return false}for(u in x){if(x.hasOwnProperty(u)&&u!=="core"&&a.inArray(u,this.settings.plugins)===-1){delete x[u]}}if(a.isEmptyObject(x.core)){delete x.core;this.set_state(x,s);return false}}if(a.isEmptyObject(x)){x=null;if(s){s.call(this)}this.trigger("set_state");return false}return true}return false},refresh:function(t,s){this._data.core.state=s===true?{}:this.get_state();if(s&&a.isFunction(s)){this._data.core.state=s.call(this,this._data.core.state)}this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}};this._data.core.selected=[];this._data.core.last_clicked=null;this._data.core.focused=null;var r=this.get_container_ul()[0].className;if(!t){this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading")}this.load_node("#",function(u,v){if(v){this.get_container_ul()[0].className=r;if(this._firstChild(this.get_container_ul()[0])){this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id)}this.set_state(a.extend(true,{},this._data.core.state),function(){this.trigger("refresh")})}this._data.core.state=null})},refresh_node:function(r){r=this.get_node(r);if(!r||r.id==="#"){return false}var t=[],v=[],u=this._data.core.selected.concat([]);v.push(r.id);if(r.state.opened===true){t.push(r.id)}this.get_node(r,true).find(".jstree-open").each(function(){t.push(this.id)});this._load_nodes(v,a.proxy(function(s){this.open_node(t,false,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:r,nodes:s})},this))},set_id:function(v,s){v=this.get_node(v);if(!v||v.id==="#"){return false}var r,t,u=this._model.data;s=s.toString();u[v.parent].children[a.inArray(v.id,u[v.parent].children)]=s;for(r=0,t=v.parents.length;r<t;r++){u[v.parents[r]].children_d[a.inArray(v.id,u[v.parents[r]].children_d)]=s}for(r=0,t=v.children.length;r<t;r++){u[v.children[r]].parent=s}for(r=0,t=v.children_d.length;r<t;r++){u[v.children_d[r]].parents[a.inArray(v.id,u[v.children_d[r]].parents)]=s}r=a.inArray(v.id,this._data.core.selected);if(r!==-1){this._data.core.selected[r]=s}r=this.get_node(v.id,true);if(r){r.attr("id",s).children(".jstree-anchor").attr("id",s+"_anchor").end().attr("aria-labelledby",s+"_anchor");if(this.element.attr("aria-activedescendant")===v.id){this.element.attr("aria-activedescendant",s)}}delete u[v.id];v.id=s;v.li_attr.id=s;u[s]=v;return true},get_text:function(r){r=this.get_node(r);return(!r||r.id==="#")?false:r.text},set_text:function(r,u){var s,t;if(a.isArray(r)){r=r.slice();for(s=0,t=r.length;s<t;s++){this.set_text(r[s],u)}return true}r=this.get_node(r);if(!r||r.id==="#"){return false}r.text=u;if(this.get_node(r,true).length){this.redraw_node(r.id)}this.trigger("set_text",{obj:r,text:u});return true},get_json:function(u,v,r){u=this.get_node(u||"#");if(!u){return false}if(v&&v.flat&&!r){r=[]}var w={id:u.id,text:u.text,icon:this.get_icon(u),li_attr:a.extend(true,{},u.li_attr),a_attr:a.extend(true,{},u.a_attr),state:{},data:v&&v.no_data?false:a.extend(true,{},u.data)},s,t;if(v&&v.flat){w.parent=u.parent}else{w.children=[]}if(!v||!v.no_state){for(s in u.state){if(u.state.hasOwnProperty(s)){w.state[s]=u.state[s]}}}if(v&&v.no_id){delete w.id;if(w.li_attr&&w.li_attr.id){delete w.li_attr.id}if(w.a_attr&&w.a_attr.id){delete w.a_attr.id}}if(v&&v.flat&&u.id!=="#"){r.push(w)}if(!v||!v.no_children){for(s=0,t=u.children.length;s<t;s++){if(v&&v.flat){this.get_json(u.children[s],v,r)}else{w.children.push(this.get_json(u.children[s],v))}}}return v&&v.flat?r:(u.id==="#"?w.children:w)},create_node:function(x,w,y,r,u){if(x===null){x="#"}x=this.get_node(x);if(!x){return false}y=y===q?"last":y;if(!y.toString().match(/^(before|after)$/)&&!u&&!this.is_loaded(x)){return this.load_node(x,function(){this.create_node(x,w,y,r,true)})}if(!w){w={text:this.get_string("New node")}}if(typeof w==="string"){w={text:w}}if(w.text===q){w.text=this.get_string("New node")}var z,s,t,v;if(x.id==="#"){if(y==="before"){y="first"}if(y==="after"){y="last"}}switch(y){case"before":z=this.get_node(x.parent);y=a.inArray(x.id,z.children);x=z;break;case"after":z=this.get_node(x.parent);y=a.inArray(x.id,z.children)+1;x=z;break;case"inside":case"first":y=0;break;case"last":y=x.children.length;break;default:if(!y){y=0}break}if(y>x.children.length){y=x.children.length}if(!w.id){w.id=true}if(!this.check("create_node",w,x,y)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(w.id===true){delete w.id}w=this._parse_model_from_json(w,x.id,x.parents.concat());if(!w){return false}z=this.get_node(w);s=[];s.push(w);s=s.concat(z.children_d);this.trigger("model",{nodes:s,parent:x.id});x.children_d=x.children_d.concat(s);for(t=0,v=x.parents.length;t<v;t++){this._model.data[x.parents[t]].children_d=this._model.data[x.parents[t]].children_d.concat(s)}w=z;z=[];for(t=0,v=x.children.length;t<v;t++){z[t>=y?t+1:t]=x.children[t]}z[y]=w.id;x.children=z;this.redraw_node(x,true);if(r){r.call(this,this.get_node(w))}this.trigger("create_node",{node:this.get_node(w),parent:x.id,position:y});return w.id},rename_node:function(r,v){var t,u,s;if(a.isArray(r)){r=r.slice();for(t=0,u=r.length;t<u;t++){this.rename_node(r[t],v)}return true}r=this.get_node(r);if(!r||r.id==="#"){return false}s=r.text;if(!this.check("rename_node",r,this.get_parent(r),v)){this.settings.core.error.call(this,this._data.core.last_error);return false}this.set_text(r,v);this.trigger("rename_node",{node:r,text:v,old:s});return true},delete_node:function(w){var z,A,x,y,B,s,t,u,v,r;if(a.isArray(w)){w=w.slice();for(z=0,A=w.length;z<A;z++){this.delete_node(w[z])}return true}w=this.get_node(w);if(!w||w.id==="#"){return false}x=this.get_node(w.parent);y=a.inArray(w.id,x.children);r=false;if(!this.check("delete_node",w,x,y)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(y!==-1){x.children=a.vakata.array_remove(x.children,y)}B=w.children_d.concat([]);B.push(w.id);for(u=0,v=B.length;u<v;u++){for(s=0,t=w.parents.length;s<t;s++){y=a.inArray(B[u],this._model.data[w.parents[s]].children_d);if(y!==-1){this._model.data[w.parents[s]].children_d=a.vakata.array_remove(this._model.data[w.parents[s]].children_d,y)}}if(this._model.data[B[u]].state.selected){r=true;y=a.inArray(B[u],this._data.core.selected);if(y!==-1){this._data.core.selected=a.vakata.array_remove(this._data.core.selected,y)}}}this.trigger("delete_node",{node:w,parent:x.id});if(r){this.trigger("changed",{action:"delete_node",node:w,selected:this._data.core.selected,parent:x.id})}for(u=0,v=B.length;u<v;u++){delete this._model.data[B[u]]}this.redraw_node(x,true);return true},check:function(s,u,v,w,t){u=u&&u.id?u:this.get_node(u);v=v&&v.id?v:this.get_node(v);var x=s.match(/^move_node|copy_node|create_node$/i)?v:u,r=this.settings.core.check_callback;if(s==="move_node"||s==="copy_node"){if((!t||!t.is_multi)&&(u.id===v.id||a.inArray(u.id,v.children)===w||a.inArray(v.id,u.children_d)!==-1)){this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:s,pos:w,obj:u&&u.id?u.id:false,par:v&&v.id?v.id:false})};return false}}if(x&&x.data){x=x.data}if(x&&x.functions&&(x.functions[s]===false||x.functions[s]===true)){if(x.functions[s]===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+s,data:JSON.stringify({chk:s,pos:w,obj:u&&u.id?u.id:false,par:v&&v.id?v.id:false})}}return x.functions[s]}if(r===false||(a.isFunction(r)&&r.call(this,s,u,v,w,t)===false)||(r&&r[s]===false)){this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+s,data:JSON.stringify({chk:s,pos:w,obj:u&&u.id?u.id:false,par:v&&v.id?v.id:false})};return false}return true},last_error:function(){return this._data.core.last_error},move_node:function(A,G,H,r,u,I,E){var J,K,C,D,z,B,v,s,L,t,w,x,y,F;G=this.get_node(G);H=H===q?0:H;if(!G){return false}if(!H.toString().match(/^(before|after)$/)&&!u&&!this.is_loaded(G)){return this.load_node(G,function(){this.move_node(A,G,H,r,true,false,E)})}if(a.isArray(A)){if(A.length===1){A=A[0]}else{for(J=0,K=A.length;J<K;J++){if((L=this.move_node(A[J],G,H,r,u,false,E))){G=L;H="after"}}this.redraw();return true}}A=A&&A.id?A:this.get_node(A);if(!A||A.id==="#"){return false}C=(A.parent||"#").toString();z=(!H.toString().match(/^(before|after)$/)||G.id==="#")?G:this.get_node(G.parent);B=E?E:(this._model.data[A.id]?this:a.jstree.reference(A.id));v=!B||!B._id||(this._id!==B._id);D=B&&B._id&&C&&B._model.data[C]&&B._model.data[C].children?a.inArray(A.id,B._model.data[C].children):-1;if(B&&B._id){A=B._model.data[A.id]}if(v){if((L=this.copy_node(A,G,H,r,u,false,E))){if(B){B.delete_node(A)}return L}return false}if(G.id==="#"){if(H==="before"){H="first"}if(H==="after"){H="last"}}switch(H){case"before":H=a.inArray(G.id,z.children);break;case"after":H=a.inArray(G.id,z.children)+1;break;case"inside":case"first":H=0;break;case"last":H=z.children.length;break;default:if(!H){H=0}break}if(H>z.children.length){H=z.children.length}if(!this.check("move_node",A,z,H,{core:true,origin:E,is_multi:(B&&B._id&&B._id!==this._id),is_foreign:(!B||!B._id)})){this.settings.core.error.call(this,this._data.core.last_error);return false}if(A.parent===z.id){s=z.children.concat();L=a.inArray(A.id,s);if(L!==-1){s=a.vakata.array_remove(s,L);if(H>L){H--}}L=[];for(t=0,w=s.length;t<w;t++){L[t>=H?t+1:t]=s[t]}L[H]=A.id;z.children=L;this._node_changed(z.id);this.redraw(z.id==="#")}else{L=A.children_d.concat();L.push(A.id);for(t=0,w=A.parents.length;t<w;t++){s=[];F=B._model.data[A.parents[t]].children_d;for(x=0,y=F.length;x<y;x++){if(a.inArray(F[x],L)===-1){s.push(F[x])}}B._model.data[A.parents[t]].children_d=s}B._model.data[C].children=a.vakata.array_remove_item(B._model.data[C].children,A.id);for(t=0,w=z.parents.length;t<w;t++){this._model.data[z.parents[t]].children_d=this._model.data[z.parents[t]].children_d.concat(L)}s=[];for(t=0,w=z.children.length;t<w;t++){s[t>=H?t+1:t]=z.children[t]}s[H]=A.id;z.children=s;z.children_d.push(A.id);z.children_d=z.children_d.concat(A.children_d);A.parent=z.id;L=z.parents.concat();L.unshift(z.id);F=A.parents.length;A.parents=L;L=L.concat();for(t=0,w=A.children_d.length;t<w;t++){this._model.data[A.children_d[t]].parents=this._model.data[A.children_d[t]].parents.slice(0,F*-1);Array.prototype.push.apply(this._model.data[A.children_d[t]].parents,L)}if(C==="#"||z.id==="#"){this._model.force_full_redraw=true}if(!this._model.force_full_redraw){this._node_changed(C);this._node_changed(z.id)}if(!I){this.redraw()}}if(r){r.call(this,A,z,H)}this.trigger("move_node",{node:A,parent:z.id,position:H,old_parent:C,old_position:D,is_multi:(B&&B._id&&B._id!==this._id),is_foreign:(!B||!B._id),old_instance:B,new_instance:this});return A.id},copy_node:function(z,D,E,r,u,F,C){var G,H,s,I,t,w,y,B,x,A,v;D=this.get_node(D);E=E===q?0:E;if(!D){return false}if(!E.toString().match(/^(before|after)$/)&&!u&&!this.is_loaded(D)){return this.load_node(D,function(){this.copy_node(z,D,E,r,true,false,C)})}if(a.isArray(z)){if(z.length===1){z=z[0]}else{for(G=0,H=z.length;G<H;G++){if((I=this.copy_node(z[G],D,E,r,u,true,C))){D=I;E="after"}}this.redraw();return true}}z=z&&z.id?z:this.get_node(z);if(!z||z.id==="#"){return false}B=(z.parent||"#").toString();x=(!E.toString().match(/^(before|after)$/)||D.id==="#")?D:this.get_node(D.parent);A=C?C:(this._model.data[z.id]?this:a.jstree.reference(z.id));v=!A||!A._id||(this._id!==A._id);if(A&&A._id){z=A._model.data[z.id]}if(D.id==="#"){if(E==="before"){E="first"}if(E==="after"){E="last"}}switch(E){case"before":E=a.inArray(D.id,x.children);break;case"after":E=a.inArray(D.id,x.children)+1;break;case"inside":case"first":E=0;break;case"last":E=x.children.length;break;default:if(!E){E=0}break}if(E>x.children.length){E=x.children.length}if(!this.check("copy_node",z,x,E,{core:true,origin:C,is_multi:(A&&A._id&&A._id!==this._id),is_foreign:(!A||!A._id)})){this.settings.core.error.call(this,this._data.core.last_error);return false}y=A?A.get_json(z,{no_id:true,no_data:true,no_state:true}):z;if(!y){return false}if(y.id===true){delete y.id}y=this._parse_model_from_json(y,x.id,x.parents.concat());if(!y){return false}I=this.get_node(y);if(z&&z.state&&z.state.loaded===false){I.state.loaded=false}s=[];s.push(y);s=s.concat(I.children_d);this.trigger("model",{nodes:s,parent:x.id});for(t=0,w=x.parents.length;t<w;t++){this._model.data[x.parents[t]].children_d=this._model.data[x.parents[t]].children_d.concat(s)}s=[];for(t=0,w=x.children.length;t<w;t++){s[t>=E?t+1:t]=x.children[t]}s[E]=I.id;x.children=s;x.children_d.push(I.id);x.children_d=x.children_d.concat(I.children_d);if(x.id==="#"){this._model.force_full_redraw=true}if(!this._model.force_full_redraw){this._node_changed(x.id)}if(!F){this.redraw(x.id==="#")}if(r){r.call(this,I,x,E)}this.trigger("copy_node",{node:I,original:z,parent:x.id,position:E,old_parent:B,old_position:A&&A._id&&B&&A._model.data[B]&&A._model.data[B].children?a.inArray(z.id,A._model.data[B].children):-1,is_multi:(A&&A._id&&A._id!==this._id),is_foreign:(!A||!A._id),old_instance:A,new_instance:this});return I.id},cut:function(s){if(!s){s=this._data.core.selected.concat()}if(!a.isArray(s)){s=[s]}if(!s.length){return false}var v=[],r,t,u;for(t=0,u=s.length;t<u;t++){r=this.get_node(s[t]);if(r&&r.id&&r.id!=="#"){v.push(r)}}if(!v.length){return false}h=v;f=this;g="move_node";this.trigger("cut",{node:s})},copy:function(s){if(!s){s=this._data.core.selected.concat()}if(!a.isArray(s)){s=[s]}if(!s.length){return false}var v=[],r,t,u;for(t=0,u=s.length;t<u;t++){r=this.get_node(s[t]);if(r&&r.id&&r.id!=="#"){v.push(r)}}if(!v.length){return false}h=v;f=this;g="copy_node";this.trigger("copy",{node:s})},get_buffer:function(){return{mode:g,node:h,inst:f}},can_paste:function(){return g!==false&&h!==false},paste:function(r,s){r=this.get_node(r);if(!r||!g||!g.match(/^(copy_node|move_node)$/)||!h){return false}if(this[g](h,r,s,false,false,false,f)){this.trigger("paste",{parent:r.id,node:h,mode:g})}h=false;g=false;f=false},clear_buffer:function(){h=false;g=false;f=false;this.trigger("clear_buffer")},edit:function(B,x,u){var C,G,r,D,E,z,A,y,F,v=false;B=this.get_node(B);if(!B){return false}if(this.settings.core.check_callback===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"};this.settings.core.error.call(this,this._data.core.last_error);return false}F=B;x=typeof x==="string"?x:B.text;this.set_text(B,"");B=this._open_to(B);F.text=x;C=this._data.core.rtl;G=this.element.width();r=B.children(".jstree-anchor");D=a("<span>");
/*
             oi = obj.children("i:visible"),
             ai = a.children("i:visible"),
             w1 = oi.width() * oi.length,
             w2 = ai.width() * ai.length,
             */
E=x;z=a("<div />",{css:{position:"absolute",top:"-200px",left:(C?"0px":"-1000px"),visibility:"hidden"}}).appendTo("body");A=a("<input />",{value:E,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:(this._data.core.li_height)+"px",lineHeight:(this._data.core.li_height)+"px",width:"150px"},blur:a.proxy(function(){var t=D.children(".jstree-rename-input"),H=t.val(),s=this.settings.core.force_text,w;if(H===""){H=E}z.remove();D.replaceWith(r);D.remove();E=s?E:a("<div></div>").append(a.parseHTML(E)).html();this.set_text(B,E);w=!!this.rename_node(B,s?a("<div></div>").text(H).text():a("<div></div>").append(a.parseHTML(H)).html());if(!w){this.set_text(B,E)}if(u){u.call(this,F,w,v)}},this),keydown:function(s){var t=s.which;if(t===27){v=true;this.value=E}if(t===27||t===13||t===37||t===38||t===39||t===40||t===32){s.stopImmediatePropagation()}if(t===27||t===13){s.preventDefault();this.blur()}},click:function(s){s.stopImmediatePropagation()},mousedown:function(s){s.stopImmediatePropagation()},keyup:function(s){A.width(Math.min(z.text("pW"+this.value).width(),G))},keypress:function(s){if(s.which===13){return false}}});y={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};D.attr("class",r.attr("class")).append(r.contents().clone()).append(A);r.replaceWith(D);z.css(y);A.css(y).width(Math.min(z.text("pW"+A[0].value).width(),G))[0].select()},set_theme:function(s,t){if(!s){return false}if(t===true){var r=this.settings.core.themes.dir;if(!r){r=a.jstree.path+"/themes"}t=r+"/"+s+"/style.css"}if(t&&a.inArray(t,o)===-1){a("head").append('<link rel="stylesheet" href="'+t+'" type="text/css" />');o.push(t)}if(this._data.core.themes.name){this.element.removeClass("jstree-"+this._data.core.themes.name)}this._data.core.themes.name=s;this.element.addClass("jstree-"+s);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+s+"-responsive");this.trigger("set_theme",{theme:s})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(r){if(this._data.core.themes.variant){this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}this._data.core.themes.variant=r;if(r){this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=true;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=false;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){if(this._data.core.themes.stripes){this.hide_stripes()}else{this.show_stripes()}},show_dots:function(){this._data.core.themes.dots=true;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=false;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){if(this._data.core.themes.dots){this.hide_dots()}else{this.show_dots()}},show_icons:function(){this._data.core.themes.icons=true;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=false;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){if(this._data.core.themes.icons){this.hide_icons()}else{this.show_icons()}},set_icon:function(t,s){var v,w,r,u;if(a.isArray(t)){t=t.slice();for(v=0,w=t.length;v<w;v++){this.set_icon(t[v],s)}return true}t=this.get_node(t);if(!t||t.id==="#"){return false}u=t.icon;t.icon=s===true||s===null||s===q||s===""?true:s;r=this.get_node(t,true).children(".jstree-anchor").children(".jstree-themeicon");if(s===false){this.hide_icon(t)}else{if(s===true||s===null||s===q||s===""){r.removeClass("jstree-themeicon-custom "+u).css("background","").removeAttr("rel");if(u===false){this.show_icon(t)}}else{if(s.indexOf("/")===-1&&s.indexOf(".")===-1){r.removeClass(u).css("background","");r.addClass(s+" jstree-themeicon-custom").attr("rel",s);if(u===false){this.show_icon(t)}}else{r.removeClass(u).css("background","");r.addClass("jstree-themeicon-custom").css("background","url('"+s+"') center center no-repeat").attr("rel",s);if(u===false){this.show_icon(t)}}}}return true},get_icon:function(r){r=this.get_node(r);return(!r||r.id==="#")?false:r.icon},hide_icon:function(r){var s,t;if(a.isArray(r)){r=r.slice();for(s=0,t=r.length;s<t;s++){this.hide_icon(r[s])}return true}r=this.get_node(r);if(!r||r==="#"){return false}r.icon=false;this.get_node(r,true).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return true},show_icon:function(s){var t,u,r;if(a.isArray(s)){s=s.slice();for(t=0,u=s.length;t<u;t++){this.show_icon(s[t])}return true}s=this.get_node(s);if(!s||s==="#"){return false}r=this.get_node(s,true);s.icon=r.length?r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):true;if(!s.icon){s.icon=true}r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return true}};a.vakata={};a.vakata.attributes=function(s,t){s=a(s)[0];var r=t?{}:[];if(s&&s.attributes){a.each(s.attributes,function(u,w){if(a.inArray(w.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])!==-1){return}if(w.value!==null&&a.trim(w.value)!==""){if(t){r[w.name]=w.value}else{r.push(w.name)}}})}return r};a.vakata.array_unique=function(s){var r=[],t,u,v,w={};for(t=0,v=s.length;t<v;t++){if(w[s[t]]===q){r.push(s[t]);w[s[t]]=true}}return r};a.vakata.array_remove=function(r,s,u){var t=r.slice((u||s)+1||r.length);r.length=s<0?r.length+s:s;r.push.apply(r,t);return r};a.vakata.array_remove_item=function(r,s){var t=a.inArray(s,r);return t!==-1?a.vakata.array_remove(r,t):r};var b=j.createElement("I");b.className="jstree-icon jstree-checkbox";b.setAttribute("role","presentation");a.jstree.defaults.checkbox={visible:true,three_state:true,whole_node:true,keep_selected_style:true,cascade:"",tie_selection:true};a.jstree.plugins.checkbox=function(r,s){this.bind=function(){s.bind.call(this);this._data.checkbox.uto=false;this._data.checkbox.selected=[];if(this.settings.checkbox.three_state){this.settings.checkbox.cascade="up+down+undetermined"}this.element.on("init.jstree",a.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;if(!this.settings.checkbox.keep_selected_style){this.element.addClass("jstree-checkbox-no-clicked")}if(this.settings.checkbox.tie_selection){this.element.addClass("jstree-checkbox-selection")}},this)).on("loading.jstree",a.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.cascade.indexOf("undetermined")!==-1){this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",a.proxy(function(){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)},this))}if(!this.settings.checkbox.tie_selection){this.element.on("model.jstree",a.proxy(function(v,t){var y=this._model.data,z=y[t.parent],u=t.nodes,w,x;for(w=0,x=u.length;w<x;w++){y[u[w]].state.checked=y[u[w]].state.checked||(y[u[w]].original&&y[u[w]].original.state&&y[u[w]].original.state.checked);if(y[u[w]].state.checked){this._data.checkbox.selected.push(u[w])}}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1){this.element.on("model.jstree",a.proxy(function(y,w){var D=this._model.data,E=D[w.parent],x=w.nodes,v=[],u,z,A,B,C,H,F=this.settings.checkbox.cascade,G=this.settings.checkbox.tie_selection;if(F.indexOf("down")!==-1){if(E.state[G?"selected":"checked"]){for(z=0,A=x.length;z<A;z++){D[x[z]].state[G?"selected":"checked"]=true}this._data[G?"core":"checkbox"].selected=this._data[G?"core":"checkbox"].selected.concat(x)}else{for(z=0,A=x.length;z<A;z++){if(D[x[z]].state[G?"selected":"checked"]){for(B=0,C=D[x[z]].children_d.length;B<C;B++){D[D[x[z]].children_d[B]].state[G?"selected":"checked"]=true}this._data[G?"core":"checkbox"].selected=this._data[G?"core":"checkbox"].selected.concat(D[x[z]].children_d)}}}}if(F.indexOf("up")!==-1){for(z=0,A=E.children_d.length;z<A;z++){if(!D[E.children_d[z]].children.length){v.push(D[E.children_d[z]].parent)}}v=a.vakata.array_unique(v);for(B=0,C=v.length;B<C;B++){E=D[v[B]];while(E&&E.id!=="#"){u=0;for(z=0,A=E.children.length;z<A;z++){u+=D[E.children[z]].state[G?"selected":"checked"]}if(u===A){E.state[G?"selected":"checked"]=true;this._data[G?"core":"checkbox"].selected.push(E.id);H=this.get_node(E,true);if(H&&H.length){H.attr("aria-selected",true).children(".jstree-anchor").addClass(G?"jstree-clicked":"jstree-checked")}}else{break}E=this.get_node(E.parent)}}}this._data[G?"core":"checkbox"].selected=a.vakata.array_unique(this._data[G?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",a.proxy(function(x,v){var B=v.node,A=this._model.data,C=this.get_node(B.parent),w=this.get_node(B,true),y,z,u,F,D=this.settings.checkbox.cascade,E=this.settings.checkbox.tie_selection;if(D.indexOf("down")!==-1){this._data[E?"core":"checkbox"].selected=a.vakata.array_unique(this._data[E?"core":"checkbox"].selected.concat(B.children_d));for(y=0,z=B.children_d.length;y<z;y++){F=A[B.children_d[y]];F.state[E?"selected":"checked"]=true;if(F&&F.original&&F.original.state&&F.original.state.undetermined){F.original.state.undetermined=false}}}if(D.indexOf("up")!==-1){while(C&&C.id!=="#"){u=0;for(y=0,z=C.children.length;y<z;y++){u+=A[C.children[y]].state[E?"selected":"checked"]}if(u===z){C.state[E?"selected":"checked"]=true;this._data[E?"core":"checkbox"].selected.push(C.id);F=this.get_node(C,true);if(F&&F.length){F.attr("aria-selected",true).children(".jstree-anchor").addClass(E?"jstree-clicked":"jstree-checked")}}else{break}C=this.get_node(C.parent)}}if(D.indexOf("down")!==-1&&w.length){w.find(".jstree-anchor").addClass(E?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",true)}},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",a.proxy(function(u,t){var y=this.get_node("#"),x=this._model.data,v,w,z;for(v=0,w=y.children_d.length;v<w;v++){z=x[y.children_d[v]];if(z&&z.original&&z.original.state&&z.original.state.undetermined){z.original.state.undetermined=false}}},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",a.proxy(function(w,u){var z=u.node,v=this.get_node(z,true),x,y,C,A=this.settings.checkbox.cascade,B=this.settings.checkbox.tie_selection;if(z&&z.original&&z.original.state&&z.original.state.undetermined){z.original.state.undetermined=false}if(A.indexOf("down")!==-1){for(x=0,y=z.children_d.length;x<y;x++){C=this._model.data[z.children_d[x]];C.state[B?"selected":"checked"]=false;if(C&&C.original&&C.original.state&&C.original.state.undetermined){C.original.state.undetermined=false}}}if(A.indexOf("up")!==-1){for(x=0,y=z.parents.length;x<y;x++){C=this._model.data[z.parents[x]];C.state[B?"selected":"checked"]=false;if(C&&C.original&&C.original.state&&C.original.state.undetermined){C.original.state.undetermined=false}C=this.get_node(z.parents[x],true);if(C&&C.length){C.attr("aria-selected",false).children(".jstree-anchor").removeClass(B?"jstree-clicked":"jstree-checked")}}}C=[];for(x=0,y=this._data[B?"core":"checkbox"].selected.length;x<y;x++){if((A.indexOf("down")===-1||a.inArray(this._data[B?"core":"checkbox"].selected[x],z.children_d)===-1)&&(A.indexOf("up")===-1||a.inArray(this._data[B?"core":"checkbox"].selected[x],z.parents)===-1)){C.push(this._data[B?"core":"checkbox"].selected[x])}}this._data[B?"core":"checkbox"].selected=a.vakata.array_unique(C);if(A.indexOf("down")!==-1&&v.length){v.find(".jstree-anchor").removeClass(B?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",false)}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1){this.element.on("delete_node.jstree",a.proxy(function(w,v){var A=this.get_node(v.parent),z=this._model.data,x,y,u,C,B=this.settings.checkbox.tie_selection;while(A&&A.id!=="#"){u=0;for(x=0,y=A.children.length;x<y;x++){u+=z[A.children[x]].state[B?"selected":"checked"]}if(u===y){A.state[B?"selected":"checked"]=true;this._data[B?"core":"checkbox"].selected.push(A.id);C=this.get_node(A,true);if(C&&C.length){C.attr("aria-selected",true).children(".jstree-anchor").addClass(B?"jstree-clicked":"jstree-checked")}}else{break}A=this.get_node(A.parent)}},this)).on("move_node.jstree",a.proxy(function(w,v){var y=v.is_multi,C=v.old_parent,B=this.get_node(v.parent),A=this._model.data,D,u,x,z,F,E=this.settings.checkbox.tie_selection;if(!y){D=this.get_node(C);while(D&&D.id!=="#"){u=0;for(x=0,z=D.children.length;x<z;x++){u+=A[D.children[x]].state[E?"selected":"checked"]}if(u===z){D.state[E?"selected":"checked"]=true;this._data[E?"core":"checkbox"].selected.push(D.id);F=this.get_node(D,true);if(F&&F.length){F.attr("aria-selected",true).children(".jstree-anchor").addClass(E?"jstree-clicked":"jstree-checked")}}else{break}D=this.get_node(D.parent)}}D=B;while(D&&D.id!=="#"){u=0;for(x=0,z=D.children.length;x<z;x++){u+=A[D.children[x]].state[E?"selected":"checked"]}if(u===z){if(!D.state[E?"selected":"checked"]){D.state[E?"selected":"checked"]=true;this._data[E?"core":"checkbox"].selected.push(D.id);F=this.get_node(D,true);if(F&&F.length){F.attr("aria-selected",true).children(".jstree-anchor").addClass(E?"jstree-clicked":"jstree-checked")}}}else{if(D.state[E?"selected":"checked"]){D.state[E?"selected":"checked"]=false;this._data[E?"core":"checkbox"].selected=a.vakata.array_remove_item(this._data[E?"core":"checkbox"].selected,D.id);F=this.get_node(D,true);if(F&&F.length){F.attr("aria-selected",false).children(".jstree-anchor").removeClass(E?"jstree-clicked":"jstree-checked")}}else{break}}D=this.get_node(D.parent)}},this))}};this._undetermined=function(){if(this.element===null){return}var u,v,w,x,z={},y=this._model.data,C=this.settings.checkbox.tie_selection,B=this._data[C?"core":"checkbox"].selected,A=[],D=this;for(u=0,v=B.length;u<v;u++){if(y[B[u]]&&y[B[u]].parents){for(w=0,x=y[B[u]].parents.length;w<x;w++){if(z[y[B[u]].parents[w]]===q&&y[B[u]].parents[w]!=="#"){z[y[B[u]].parents[w]]=true;A.push(y[B[u]].parents[w])}}}}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var t=D.get_node(this),E;if(!t.state.loaded){if(t.original&&t.original.state&&t.original.state.undetermined&&t.original.state.undetermined===true){if(z[t.id]===q&&t.id!=="#"){z[t.id]=true;A.push(t.id)}for(w=0,x=t.parents.length;w<x;w++){if(z[t.parents[w]]===q&&t.parents[w]!=="#"){z[t.parents[w]]=true;A.push(t.parents[w])}}}}else{for(u=0,v=t.children_d.length;u<v;u++){E=y[t.children_d[u]];if(!E.state.loaded&&E.original&&E.original.state&&E.original.state.undetermined&&E.original.state.undetermined===true){if(z[E.id]===q&&E.id!=="#"){z[E.id]=true;A.push(E.id)}for(w=0,x=E.parents.length;w<x;w++){if(z[E.parents[w]]===q&&E.parents[w]!=="#"){z[E.parents[w]]=true;A.push(E.parents[w])}}}}}});this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");for(u=0,v=A.length;u<v;u++){if(!y[A[u]].state[C?"selected":"checked"]){B=this.get_node(A[u],true);if(B&&B.length){B.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}}}};this.redraw_node=function(z,t,x,u){z=s.redraw_node.apply(this,arguments);if(z){var v,y,A=null,w=null;for(v=0,y=z.childNodes.length;v<y;v++){if(z.childNodes[v]&&z.childNodes[v].className&&z.childNodes[v].className.indexOf("jstree-anchor")!==-1){A=z.childNodes[v];break}}if(A){if(!this.settings.checkbox.tie_selection&&this._model.data[z.id].state.checked){A.className+=" jstree-checked"}w=b.cloneNode(false);if(this._model.data[z.id].state.checkbox_disabled){w.className+=" jstree-checkbox-disabled"}A.insertBefore(w,A.childNodes[0])}}if(!x&&this.settings.checkbox.cascade.indexOf("undetermined")!==-1){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)}return z};this.show_checkboxes=function(){this._data.core.themes.checkboxes=true;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=false;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){if(this._data.core.themes.checkboxes){this.hide_checkboxes()}else{this.show_checkboxes()}};this.is_undetermined=function(y){y=this.get_node(y);var z=this.settings.checkbox.cascade,v,w,A=this.settings.checkbox.tie_selection,u=this._data[A?"core":"checkbox"].selected,x=this._model.data;if(!y||y.state[A?"selected":"checked"]===true||z.indexOf("undetermined")===-1||(z.indexOf("down")===-1&&z.indexOf("up")===-1)){return false}if(!y.state.loaded&&y.original.state.undetermined===true){return true}for(v=0,w=y.children_d.length;v<w;v++){if(a.inArray(y.children_d[v],u)!==-1||(!x[y.children_d[v]].state.loaded&&x[y.children_d[v]].original.state.undetermined)){return true}}return false};this.disable_checkbox=function(u){var v,w,t;if(a.isArray(u)){u=u.slice();for(v=0,w=u.length;v<w;v++){this.disable_checkbox(u[v])}return true}u=this.get_node(u);if(!u||u.id==="#"){return false}t=this.get_node(u,true);if(!u.state.checkbox_disabled){u.state.checkbox_disabled=true;if(t&&t.length){t.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled")}this.trigger("disable_checkbox",{node:u})}};this.enable_checkbox=function(u){var v,w,t;if(a.isArray(u)){u=u.slice();for(v=0,w=u.length;v<w;v++){this.enable_checkbox(u[v])}return true}u=this.get_node(u);if(!u||u.id==="#"){return false}t=this.get_node(u,true);if(u.state.checkbox_disabled){u.state.checkbox_disabled=false;if(t&&t.length){t.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled")}this.trigger("enable_checkbox",{node:u})}};this.activate_node=function(u,t){if(a(t.target).hasClass("jstree-checkbox-disabled")){return false}if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||a(t.target).hasClass("jstree-checkbox"))){t.ctrlKey=true}if(this.settings.checkbox.tie_selection||(!this.settings.checkbox.whole_node&&!a(t.target).hasClass("jstree-checkbox"))){return s.activate_node.call(this,u,t)}if(this.is_disabled(u)){return false}if(this.is_checked(u)){this.uncheck_node(u,t)}else{this.check_node(u,t)}this.trigger("activate_node",{node:this.get_node(u)})};this.check_node=function(v,u){if(this.settings.checkbox.tie_selection){return this.select_node(v,false,true,u)}var t,w,x,y;if(a.isArray(v)){v=v.slice();for(w=0,x=v.length;w<x;w++){this.check_node(v[w],u)}return true}v=this.get_node(v);if(!v||v.id==="#"){return false}t=this.get_node(v,true);if(!v.state.checked){v.state.checked=true;this._data.checkbox.selected.push(v.id);if(t&&t.length){t.children(".jstree-anchor").addClass("jstree-checked")}this.trigger("check_node",{node:v,selected:this._data.checkbox.selected,event:u})}};this.uncheck_node=function(v,u){if(this.settings.checkbox.tie_selection){return this.deselect_node(v,false,u)}var w,x,t;if(a.isArray(v)){v=v.slice();for(w=0,x=v.length;w<x;w++){this.uncheck_node(v[w],u)}return true}v=this.get_node(v);if(!v||v.id==="#"){return false}t=this.get_node(v,true);if(v.state.checked){v.state.checked=false;this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,v.id);if(t.length){t.children(".jstree-anchor").removeClass("jstree-checked")}this.trigger("uncheck_node",{node:v,selected:this._data.checkbox.selected,event:u})}};this.check_all=function(){if(this.settings.checkbox.tie_selection){return this.select_all()}var v=this._data.checkbox.selected.concat([]),t,u;this._data.checkbox.selected=this._model.data["#"].children_d.concat();for(t=0,u=this._data.checkbox.selected.length;t<u;t++){if(this._model.data[this._data.checkbox.selected[t]]){this._model.data[this._data.checkbox.selected[t]].state.checked=true}}this.redraw(true);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection){return this.deselect_all()}var v=this._data.checkbox.selected.concat([]),t,u;for(t=0,u=this._data.checkbox.selected.length;t<u;t++){if(this._model.data[this._data.checkbox.selected[t]]){this._model.data[this._data.checkbox.selected[t]].state.checked=false}}this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:v})};this.is_checked=function(t){if(this.settings.checkbox.tie_selection){return this.is_selected(t)}t=this.get_node(t);if(!t||t.id==="#"){return false}return t.state.checked};this.get_checked=function(t){if(this.settings.checkbox.tie_selection){return this.get_selected(t)}return t?a.map(this._data.checkbox.selected,a.proxy(function(u){return this.get_node(u)},this)):this._data.checkbox.selected};this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection){return this.get_top_selected(t)}var z=this.get_checked(true),y={},u,v,w,x;for(u=0,v=z.length;u<v;u++){y[z[u].id]=z[u]}for(u=0,v=z.length;u<v;u++){for(w=0,x=z[u].children_d.length;w<x;w++){if(y[z[u].children_d[w]]){delete y[z[u].children_d[w]]}}}z=[];for(u in y){if(y.hasOwnProperty(u)){z.push(u)}}return t?a.map(z,a.proxy(function(A){return this.get_node(A)},this)):z};this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection){return this.get_bottom_selected(t)}var x=this.get_checked(true),w=[],u,v;for(u=0,v=x.length;u<v;u++){if(!x[u].children.length){w.push(x[u].id)}}return t?a.map(w,a.proxy(function(y){return this.get_node(y)},this)):w};this.load_node=function(z,u){var x,y,v,w,t,A;if(!a.isArray(z)&&!this.settings.checkbox.tie_selection){A=this.get_node(z);if(A&&A.state.loaded){for(x=0,y=A.children_d.length;x<y;x++){if(this._model.data[A.children_d[x]].state.checked){t=true;this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,A.children_d[x])}}}}return s.load_node.apply(this,arguments)};this.get_state=function(){var t=s.get_state.apply(this,arguments);if(this.settings.checkbox.tie_selection){return t}t.checkbox=this._data.checkbox.selected.slice();return t};this.set_state=function(w,u){var v=s.set_state.apply(this,arguments);if(v&&w.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var t=this;a.each(w.checkbox,function(x,y){t.check_node(y)})}delete w.checkbox;this.set_state(w,u);return false}return v};this.refresh=function(u,t){if(!this.settings.checkbox.tie_selection){this._data.checkbox.selected=[]}return s.refresh.apply(this,arguments)}};a.jstree.defaults.contextmenu={select_node:true,show_at_node:true,items:function(s,r){return{create:{separator_before:false,separator_after:true,_disabled:false,label:"Create",action:function(t){var u=a.jstree.reference(t.reference),v=u.get_node(t.reference);u.create_node(v,{},"last",function(w){setTimeout(function(){u.edit(w)},0)})}},rename:{separator_before:false,separator_after:false,_disabled:false,label:"Rename",action:function(t){var u=a.jstree.reference(t.reference),v=u.get_node(t.reference);u.edit(v)}},remove:{separator_before:false,icon:false,separator_after:false,_disabled:false,label:"Delete",action:function(t){var u=a.jstree.reference(t.reference),v=u.get_node(t.reference);if(u.is_selected(v)){u.delete_node(u.get_selected())}else{u.delete_node(v)}}},ccp:{separator_before:true,icon:false,separator_after:false,label:"Edit",action:false,submenu:{cut:{separator_before:false,separator_after:false,label:"Cut",action:function(t){var u=a.jstree.reference(t.reference),v=u.get_node(t.reference);if(u.is_selected(v)){u.cut(u.get_top_selected())}else{u.cut(v)}}},copy:{separator_before:false,icon:false,separator_after:false,label:"Copy",action:function(t){var u=a.jstree.reference(t.reference),v=u.get_node(t.reference);if(u.is_selected(v)){u.copy(u.get_top_selected())}else{u.copy(v)}}},paste:{separator_before:false,icon:false,_disabled:function(t){return !a.jstree.reference(t.reference).can_paste()},separator_after:false,label:"Paste",action:function(t){var u=a.jstree.reference(t.reference),v=u.get_node(t.reference);u.paste(v)}}}}}}};a.jstree.plugins.contextmenu=function(r,s){this.bind=function(){s.bind.call(this);var w=0,t=null,u,v;this.element.on("contextmenu.jstree",".jstree-anchor",a.proxy(function(y,x){y.preventDefault();w=y.ctrlKey?+new Date():0;if(x||t){w=(+new Date())+10000}if(t){clearTimeout(t)}if(!this.is_loading(y.currentTarget)){this.show_contextmenu(y.currentTarget,y.pageX,y.pageY,y)}},this)).on("click.jstree",".jstree-anchor",a.proxy(function(x){if(this._data.contextmenu.visible&&(!w||(+new Date())-w>250)){a.vakata.context.hide()}w=0},this)).on("touchstart.jstree",".jstree-anchor",function(x){if(!x.originalEvent||!x.originalEvent.changedTouches||!x.originalEvent.changedTouches[0]){return}u=x.pageX;v=x.pageY;t=setTimeout(function(){a(x.currentTarget).trigger("contextmenu",true)},750)}).on("touchmove.vakata.jstree",function(x){if(t&&x.originalEvent&&x.originalEvent.changedTouches&&x.originalEvent.changedTouches[0]&&(Math.abs(u-x.pageX)>50||Math.abs(v-x.pageY)>50)){clearTimeout(t)}}).on("touchend.vakata.jstree",function(x){if(t){clearTimeout(t)}});a(j).on("context_hide.vakata.jstree",a.proxy(function(){this._data.contextmenu.visible=false},this))};this.teardown=function(){if(this._data.contextmenu.visible){a.vakata.context.hide()}s.teardown.call(this)};this.show_contextmenu=function(A,C,D,v){A=this.get_node(A);if(!A||A.id==="#"){return false}var B=this.settings.contextmenu,u=this.get_node(A,true),t=u.children(".jstree-anchor"),z=false,w=false;if(B.show_at_node||C===q||D===q){z=t.offset();C=z.left;D=z.top+this._data.core.li_height}if(this.settings.contextmenu.select_node&&!this.is_selected(A)){this.activate_node(A,v)}w=B.items;if(a.isFunction(w)){w=w.call(this,A,a.proxy(function(x){this._show_contextmenu(A,C,D,x)},this))}if(a.isPlainObject(w)){this._show_contextmenu(A,C,D,w)}};this._show_contextmenu=function(w,z,A,v){var u=this.get_node(w,true),t=u.children(".jstree-anchor");a(j).one("context_show.vakata.jstree",a.proxy(function(B,y){var x="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";a(y.element).addClass(x)},this));this._data.contextmenu.visible=true;a.vakata.context.show(t,{x:z,y:A},v);this.trigger("show_contextmenu",{node:w,x:z,y:A})}};(function(r){var s=false,t={element:false,reference:false,position_x:0,position_y:0,items:[],html:"",is_visible:false};r.vakata.context={settings:{hide_onmouseleave:0,icons:true},_trigger:function(u){r(j).triggerHandler("context_"+u+".vakata",{reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}})},_execute:function(u){u=t.items[u];return u&&(!u._disabled||(r.isFunction(u._disabled)&&!u._disabled({item:u,reference:t.reference,element:t.element})))&&u.action?u.action.call(null,{item:u,reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}}):false},_parse:function(v,u){if(!v){return false}if(!u){t.html="";t.items=[]}var x="",w=false,y;if(u){x+="<ul>"}r.each(v,function(z,A){if(!A){return true}t.items.push(A);if(!w&&A.separator_before){x+="<li class='vakata-context-separator'><a href='#' "+(r.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"}w=false;x+="<li class='"+(A._class||"")+(A._disabled===true||(r.isFunction(A._disabled)&&A._disabled({item:A,reference:t.reference,element:t.element}))?" vakata-contextmenu-disabled ":"")+"' "+(A.shortcut?" data-shortcut='"+A.shortcut+"' ":"")+">";x+="<a href='#' rel='"+(t.items.length-1)+"'>";if(r.vakata.context.settings.icons){x+="<i ";if(A.icon){if(A.icon.indexOf("/")!==-1||A.icon.indexOf(".")!==-1){x+=" style='background:url(\""+A.icon+"\") center center no-repeat' "}else{x+=" class='"+A.icon+"' "}}x+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"}x+=(r.isFunction(A.label)?A.label({item:z,reference:t.reference,element:t.element}):A.label)+(A.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+A.shortcut+'">'+(A.shortcut_label||"")+"</span>":"")+"</a>";if(A.submenu){y=r.vakata.context._parse(A.submenu,true);if(y){x+=y}}x+="</li>";if(A.separator_after){x+="<li class='vakata-context-separator'><a href='#' "+(r.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>";w=true}});x=x.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");if(u){x+="</ul>"}if(!u){t.html=x;r.vakata.context._trigger("parse")}return x.length>10?x:false},_show_submenu:function(B){B=r(B);if(!B.length||!B.children("ul").length){return}var z=B.children("ul"),D=B.offset().left+B.outerWidth(),E=B.offset().top,C=z.width(),A=z.height(),v=r(window).width()+r(window).scrollLeft(),u=r(window).height()+r(window).scrollTop();if(s){B[D-(C+10+B.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left")}else{B[D+C+10>v?"addClass":"removeClass"]("vakata-context-right")}if(E+A+10>u){z.css("bottom","-1px")}z.show()},show:function(F,E,v){var D,B,H,I,G,C,A,z,u=true;if(t.element&&t.element.length){t.element.width("")}switch(u){case (!E&&!F):return false;case (!!E&&!!F):t.reference=F;t.position_x=E.x;t.position_y=E.y;break;case (!E&&!!F):t.reference=F;D=F.offset();t.position_x=D.left+F.outerHeight();t.position_y=D.top;break;case (!!E&&!F):t.position_x=E.x;t.position_y=E.y;break}if(!!F&&!v&&r(F).data("vakata_contextmenu")){v=r(F).data("vakata_contextmenu")}if(r.vakata.context._parse(v)){t.element.html(t.html)}if(t.items.length){t.element.appendTo("body");B=t.element;H=t.position_x;I=t.position_y;G=B.width();C=B.height();A=r(window).width()+r(window).scrollLeft();z=r(window).height()+r(window).scrollTop();if(s){H-=(B.outerWidth()-r(F).outerWidth());if(H<r(window).scrollLeft()+20){H=r(window).scrollLeft()+20}}if(H+G+20>A){H=A-(G+20)}if(I+C+20>z){I=z-(C+20)}t.element.css({left:H,top:I}).show().find("a").first().focus().parent().addClass("vakata-context-hover");t.is_visible=true;r.vakata.context._trigger("show")}},hide:function(){if(t.is_visible){t.element.hide().find("ul").hide().end().find(":focus").blur().end().detach();t.is_visible=false;r.vakata.context._trigger("hide")}}};r(function(){s=r("body").css("direction")==="rtl";var u=false;t.element=r("<ul class='vakata-context'></ul>");t.element.on("mouseenter","li",function(v){v.stopImmediatePropagation();if(r.contains(this,v.relatedTarget)){return}if(u){clearTimeout(u)}t.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end();r(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover");r.vakata.context._show_submenu(this)}).on("mouseleave","li",function(v){if(r.contains(this,v.relatedTarget)){return}r(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(v){r(this).find(".vakata-context-hover").removeClass("vakata-context-hover");if(r.vakata.context.settings.hide_onmouseleave){u=setTimeout((function(w){return function(){r.vakata.context.hide()}}(this)),r.vakata.context.settings.hide_onmouseleave)}}).on("click","a",function(v){v.preventDefault();if(!r(this).blur().parent().hasClass("vakata-context-disabled")&&r.vakata.context._execute(r(this).attr("rel"))!==false){r.vakata.context.hide()}}).on("keydown","a",function(v){var w=null;switch(v.which){case 13:case 32:v.type="mouseup";v.preventDefault();r(v.currentTarget).trigger(v);break;case 37:if(t.is_visible){t.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus();v.stopImmediatePropagation();v.preventDefault()}break;case 38:if(t.is_visible){w=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();if(!w.length){w=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()}w.addClass("vakata-context-hover").children("a").focus();v.stopImmediatePropagation();v.preventDefault()}break;case 39:if(t.is_visible){t.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus();v.stopImmediatePropagation();v.preventDefault()}break;case 40:if(t.is_visible){w=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first();if(!w.length){w=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()}w.addClass("vakata-context-hover").children("a").focus();v.stopImmediatePropagation();v.preventDefault()}break;case 27:r.vakata.context.hide();v.preventDefault();break;default:break}}).on("keydown",function(w){w.preventDefault();var v=t.element.find(".vakata-contextmenu-shortcut-"+w.which).parent();if(v.parent().not(".vakata-context-disabled")){v.click()}});r(j).on("mousedown.vakata.jstree",function(v){if(t.is_visible&&!r.contains(t.element[0],v.target)){r.vakata.context.hide()}}).on("context_show.vakata.jstree",function(w,v){t.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");if(s){t.element.addClass("vakata-context-rtl").css("direction","rtl")}t.element.find("ul").hide().end()})})}(a));a.jstree.defaults.dnd={copy:true,open_timeout:500,is_draggable:true,check_while_dragging:true,always_copy:false,inside_pos:0,drag_selection:true,touch:true,large_drop_target:false,large_drag_target:false};a.jstree.plugins.dnd=function(r,s){this.bind=function(){s.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",a.proxy(function(t){if(this.settings.dnd.large_drag_target&&a(t.target).closest(".jstree-node")[0]!==t.currentTarget){return true}if(t.type==="touchstart"&&(!this.settings.dnd.touch||(this.settings.dnd.touch==="selected"&&!a(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))){return true}var v=this.get_node(t.target),u=this.is_selected(v)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,w=(u>1?u+" "+this.get_string("nodes"):this.get_text(t.currentTarget));if(this.settings.core.force_text){w=a.vakata.html.escape(w)}if(v&&v.id&&v.id!=="#"&&(t.which===1||t.type==="touchstart")&&(this.settings.dnd.is_draggable===true||(a.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,(u>1?this.get_top_selected(true):[v]),t)))){this.element.trigger("mousedown.jstree");return a.vakata.dnd.start(t,{jstree:true,origin:this,obj:this.get_node(v,true),nodes:u>1?this.get_top_selected():[v.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+w+'<ins class="jstree-copy" style="display:none;">+</ins></div>')}},this))}};a(function(){var t=false,r=false,s=false,v=false,u=a('<div id="jstree-marker">&#160;</div>').hide();a(j).on("dnd_start.vakata.jstree",function(x,w){t=false;s=false;if(!w||!w.data||!w.data.jstree){return}u.appendTo("body")}).on("dnd_move.vakata.jstree",function(x,w){if(v){clearTimeout(v)}if(!w||!w.data||!w.data.jstree){return}if(w.event.target.id&&w.event.target.id==="jstree-marker"){return}s=w.event;var A=a.jstree.reference(w.event.target),K=false,E=false,L=false,Q,C,M,y,H,z,D,F,N,O,G,J,I,B,P;if(A&&A._data&&A._data.dnd){u.attr("class","jstree-"+A.get_theme()+(A.settings.core.themes.responsive?" jstree-dnd-responsive":""));w.helper.children().attr("class","jstree-"+A.get_theme()+" jstree-"+A.get_theme()+"-"+A.get_theme_variant()+" "+(A.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[w.data.origin&&(w.data.origin.settings.dnd.always_copy||(w.data.origin.settings.dnd.copy&&(w.event.metaKey||w.event.ctrlKey)))?"show":"hide"]();if((w.event.target===A.element[0]||w.event.target===A.get_container_ul()[0])&&A.get_container_ul().children().length===0){F=true;for(N=0,O=w.data.nodes.length;N<O;N++){F=F&&A.check((w.data.origin&&(w.data.origin.settings.dnd.always_copy||(w.data.origin.settings.dnd.copy&&(w.event.metaKey||w.event.ctrlKey)))?"copy_node":"move_node"),(w.data.origin&&w.data.origin!==A?w.data.origin.get_node(w.data.nodes[N]):w.data.nodes[N]),"#","last",{dnd:true,ref:A.get_node("#"),pos:"i",origin:w.data.origin,is_multi:(w.data.origin&&w.data.origin!==A),is_foreign:(!w.data.origin)});if(!F){break}}if(F){t={ins:A,par:"#",pos:"last"};u.hide();w.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");return}}else{K=A.settings.dnd.large_drop_target?a(w.event.target).closest(".jstree-node").children(".jstree-anchor"):a(w.event.target).closest(".jstree-anchor");if(K&&K.length&&K.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){E=K.offset();L=w.event.pageY-E.top;y=K.outerHeight();if(L<y/3){D=["b","i","a"]}else{if(L>y-y/3){D=["a","i","b"]}else{D=L>y/2?["i","a","b"]:["i","b","a"]}}a.each(D,function(R,S){switch(S){case"b":C=E.left-6;M=E.top;H=A.get_parent(K);z=K.parent().index();break;case"i":B=A.settings.dnd.inside_pos;P=A.get_node(K.parent());C=E.left-2;M=E.top+y/2+1;H=P.id;z=B==="first"?0:(B==="last"?P.children.length:Math.min(B,P.children.length));break;case"a":C=E.left-6;M=E.top+y;H=A.get_parent(K);z=K.parent().index()+1;break}F=true;for(N=0,O=w.data.nodes.length;N<O;N++){G=w.data.origin&&(w.data.origin.settings.dnd.always_copy||(w.data.origin.settings.dnd.copy&&(w.event.metaKey||w.event.ctrlKey)))?"copy_node":"move_node";J=z;if(G==="move_node"&&S==="a"&&(w.data.origin&&w.data.origin===A)&&H===A.get_parent(w.data.nodes[N])){I=A.get_node(H);if(J>a.inArray(w.data.nodes[N],I.children)){J-=1}}F=F&&((A&&A.settings&&A.settings.dnd&&A.settings.dnd.check_while_dragging===false)||A.check(G,(w.data.origin&&w.data.origin!==A?w.data.origin.get_node(w.data.nodes[N]):w.data.nodes[N]),H,J,{dnd:true,ref:A.get_node(K.parent()),pos:S,origin:w.data.origin,is_multi:(w.data.origin&&w.data.origin!==A),is_foreign:(!w.data.origin)}));if(!F){if(A&&A.last_error){r=A.last_error()}break}}if(S==="i"&&K.parent().is(".jstree-closed")&&A.settings.dnd.open_timeout){v=setTimeout((function(T,U){return function(){T.open_node(U)}}(A,K)),A.settings.dnd.open_timeout)}if(F){t={ins:A,par:H,pos:S==="i"&&B==="last"&&z===0&&!A.is_loaded(P)?"last":z};u.css({left:C+"px",top:M+"px"}).show();w.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");r={};D=true;return false}});if(D===true){return}}}}t=false;w.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");u.hide()}).on("dnd_scroll.vakata.jstree",function(x,w){if(!w||!w.data||!w.data.jstree){return}u.hide();t=false;s=false;w.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er")}).on("dnd_stop.vakata.jstree",function(x,w){if(v){clearTimeout(v)}if(!w||!w.data||!w.data.jstree){return}u.hide().detach();var y,z,A=[];if(t){for(y=0,z=w.data.nodes.length;y<z;y++){A[y]=w.data.origin?w.data.origin.get_node(w.data.nodes[y]):w.data.nodes[y]}t.ins[w.data.origin&&(w.data.origin.settings.dnd.always_copy||(w.data.origin.settings.dnd.copy&&(w.event.metaKey||w.event.ctrlKey)))?"copy_node":"move_node"](A,t.par,t.pos,false,false,false,w.data.origin)}else{y=a(w.event.target).closest(".jstree");if(y.length&&r&&r.error&&r.error==="check"){y=y.jstree(true);if(y){y.settings.core.error.call(this,r)}}}s=false;t=false}).on("keyup.jstree keydown.jstree",function(x,w){w=a.vakata.dnd._get();if(w&&w.data&&w.data.jstree){w.helper.find(".jstree-copy").first()[w.data.origin&&(w.data.origin.settings.dnd.always_copy||(w.data.origin.settings.dnd.copy&&(x.metaKey||x.ctrlKey)))?"show":"hide"]();if(s){s.metaKey=x.metaKey;s.ctrlKey=x.ctrlKey;a.vakata.dnd._trigger("move",s)}}})});(function(r){r.vakata.html={div:r("<div />"),escape:function(t){return r.vakata.html.div.text(t).html()},strip:function(t){return r.vakata.html.div.empty().append(r.parseHTML(t)).text()}};var s={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};r.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(v,u){var t=r.vakata.dnd._get();t.event=u;r(j).triggerHandler("dnd_"+v+".vakata",t)},_get:function(){return{data:s.data,element:s.element,helper:s.helper}},_clean:function(){if(s.helper){s.helper.remove()}if(s.scroll_i){clearInterval(s.scroll_i);s.scroll_i=false}s={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};r(j).off("mousemove.vakata.jstree touchmove.vakata.jstree",r.vakata.dnd.drag);r(j).off("mouseup.vakata.jstree touchend.vakata.jstree",r.vakata.dnd.stop)},_scroll:function(u){if(!s.scroll_e||(!s.scroll_l&&!s.scroll_t)){if(s.scroll_i){clearInterval(s.scroll_i);s.scroll_i=false}return false}if(!s.scroll_i){s.scroll_i=setInterval(r.vakata.dnd._scroll,100);return false}if(u===true){return false}var t=s.scroll_e.scrollTop(),v=s.scroll_e.scrollLeft();s.scroll_e.scrollTop(t+s.scroll_t*r.vakata.dnd.settings.scroll_speed);s.scroll_e.scrollLeft(v+s.scroll_l*r.vakata.dnd.settings.scroll_speed);if(t!==s.scroll_e.scrollTop()||v!==s.scroll_e.scrollLeft()){r.vakata.dnd._trigger("scroll",s.scroll_e)}},start:function(u,t,v){if(u.type==="touchstart"&&u.originalEvent&&u.originalEvent.changedTouches&&u.originalEvent.changedTouches[0]){u.pageX=u.originalEvent.changedTouches[0].pageX;u.pageY=u.originalEvent.changedTouches[0].pageY;u.target=j.elementFromPoint(u.originalEvent.changedTouches[0].pageX-window.pageXOffset,u.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(s.is_drag){r.vakata.dnd.stop({})}try{u.currentTarget.unselectable="on";u.currentTarget.onselectstart=function(){return false};if(u.currentTarget.style){u.currentTarget.style.MozUserSelect="none"}}catch(w){}s.init_x=u.pageX;s.init_y=u.pageY;s.data=t;s.is_down=true;s.element=u.currentTarget;s.target=u.target;s.is_touch=u.type==="touchstart";if(v!==false){s.helper=r("<div id='vakata-dnd'></div>").html(v).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})}r(j).on("mousemove.vakata.jstree touchmove.vakata.jstree",r.vakata.dnd.drag);r(j).on("mouseup.vakata.jstree touchend.vakata.jstree",r.vakata.dnd.stop);return false},drag:function(z){if(z.type==="touchmove"&&z.originalEvent&&z.originalEvent.changedTouches&&z.originalEvent.changedTouches[0]){z.pageX=z.originalEvent.changedTouches[0].pageX;z.pageY=z.originalEvent.changedTouches[0].pageY;z.target=j.elementFromPoint(z.originalEvent.changedTouches[0].pageX-window.pageXOffset,z.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(!s.is_down){return}if(!s.is_drag){if(Math.abs(z.pageX-s.init_x)>(s.is_touch?r.vakata.dnd.settings.threshold_touch:r.vakata.dnd.settings.threshold)||Math.abs(z.pageY-s.init_y)>(s.is_touch?r.vakata.dnd.settings.threshold_touch:r.vakata.dnd.settings.threshold)){if(s.helper){s.helper.appendTo("body");s.helper_w=s.helper.outerWidth()}s.is_drag=true;r.vakata.dnd._trigger("start",z)}else{return}}var t=false,C=false,u=false,D=false,y=false,E=false,x=false,v=false,B=false,A=false;s.scroll_t=0;s.scroll_l=0;s.scroll_e=false;r(r(z.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return(/^auto|scroll$/).test(r(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var F=r(this),w=F.offset();if(this.scrollHeight>this.offsetHeight){if(w.top+F.height()-z.pageY<r.vakata.dnd.settings.scroll_proximity){s.scroll_t=1}if(z.pageY-w.top<r.vakata.dnd.settings.scroll_proximity){s.scroll_t=-1}}if(this.scrollWidth>this.offsetWidth){if(w.left+F.width()-z.pageX<r.vakata.dnd.settings.scroll_proximity){s.scroll_l=1}if(z.pageX-w.left<r.vakata.dnd.settings.scroll_proximity){s.scroll_l=-1}}if(s.scroll_t||s.scroll_l){s.scroll_e=r(this);return false}});if(!s.scroll_e){t=r(j);C=r(window);u=t.height();D=C.height();y=t.width();E=C.width();x=t.scrollTop();v=t.scrollLeft();if(u>D&&z.pageY-x<r.vakata.dnd.settings.scroll_proximity){s.scroll_t=-1}if(u>D&&D-(z.pageY-x)<r.vakata.dnd.settings.scroll_proximity){s.scroll_t=1}if(y>E&&z.pageX-v<r.vakata.dnd.settings.scroll_proximity){s.scroll_l=-1}if(y>E&&E-(z.pageX-v)<r.vakata.dnd.settings.scroll_proximity){s.scroll_l=1}if(s.scroll_t||s.scroll_l){s.scroll_e=t}}if(s.scroll_e){r.vakata.dnd._scroll(true)}if(s.helper){B=parseInt(z.pageY+r.vakata.dnd.settings.helper_top,10);A=parseInt(z.pageX+r.vakata.dnd.settings.helper_left,10);if(u&&B+25>u){B=u-50}if(y&&A+s.helper_w>y){A=y-(s.helper_w+2)}s.helper.css({left:A+"px",top:B+"px"})}r.vakata.dnd._trigger("move",z);return false},stop:function(t){if(t.type==="touchend"&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]){t.pageX=t.originalEvent.changedTouches[0].pageX;t.pageY=t.originalEvent.changedTouches[0].pageY;t.target=j.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(s.is_drag){r.vakata.dnd._trigger("stop",t)}else{if(t.type==="touchend"&&t.target===s.target){var u=setTimeout(function(){r(t.target).click()},100);r(t.target).one("click",function(){if(u){clearTimeout(u)}})}}r.vakata.dnd._clean();return false}}}(a));a.jstree.defaults.massload=null;a.jstree.plugins.massload=function(r,s){this.init=function(t,u){s.init.call(this,t,u);this._data.massload={}};this._load_nodes=function(v,t,u){var w=this.settings.massload;if(u&&!a.isEmptyObject(this._data.massload)){return s._load_nodes.call(this,v,t,u)}if(a.isFunction(w)){return w.call(this,v,a.proxy(function(x){if(x){for(var y in x){if(x.hasOwnProperty(y)){this._data.massload[y]=x[y]}}}s._load_nodes.call(this,v,t,u)},this))}if(typeof w==="object"&&w&&w.url){w=a.extend(true,{},w);if(a.isFunction(w.url)){w.url=w.url.call(this,v)}if(a.isFunction(w.data)){w.data=w.data.call(this,v)}return a.ajax(w).done(a.proxy(function(y,A,B){if(y){for(var z in y){if(y.hasOwnProperty(z)){this._data.massload[z]=y[z]}}}s._load_nodes.call(this,v,t,u)},this)).fail(a.proxy(function(x){s._load_nodes.call(this,v,t,u)},this))}return s._load_nodes.call(this,v,t,u)};this._load_node=function(v,t){var u=this._data.massload[v.id];if(u){return this[typeof u==="string"?"_append_html_data":"_append_json_data"](v,typeof u==="string"?a(a.parseHTML(u)).filter(function(){return this.nodeType!==3}):u,function(w){t.call(this,w);delete this._data.massload[v.id]})}return s._load_node.call(this,v,t)}};a.jstree.defaults.search={ajax:false,fuzzy:false,case_sensitive:false,show_only_matches:false,show_only_matches_children:false,close_opened_onclear:true,search_leaves_only:false,search_callback:false};a.jstree.plugins.search=function(r,s){this.bind=function(){s.bind.call(this);this._data.search.str="";this._data.search.dom=a();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=false;this._data.search.smc=false;this.element.on("before_open.jstree",a.proxy(function(u,t){var w,x,v,z=this._data.search.res,A=[],y=a();if(z&&z.length){this._data.search.dom=a(this.element[0].querySelectorAll("#"+a.map(z,function(B){return"0123456789".indexOf(B[0])!==-1?"\\3"+B[0]+" "+B.substr(1).replace(a.jstree.idregex,"\\$&"):B.replace(a.jstree.idregex,"\\$&")}).join(", #")));this._data.search.dom.children(".jstree-anchor").addClass("jstree-search");if(this._data.search.som&&this._data.search.res.length){for(w=0,x=z.length;w<x;w++){A=A.concat(this.get_node(z[w]).parents)}A=a.vakata.array_remove_item(a.vakata.array_unique(A),"#");y=A.length?a(this.element[0].querySelectorAll("#"+a.map(A,function(B){return"0123456789".indexOf(B[0])!==-1?"\\3"+B[0]+" "+B.substr(1).replace(a.jstree.idregex,"\\$&"):B.replace(a.jstree.idregex,"\\$&")}).join(", #"))):a();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");y=y.add(this._data.search.dom);if(this._data.search.smc){this._data.search.dom.children(".jstree-children").find(".jstree-node").show()}y.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){a(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}},this)).on("search.jstree",a.proxy(function(u,t){if(this._data.search.som){if(t.nodes.length){this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");if(this._data.search.smc){t.nodes.children(".jstree-children").find(".jstree-node").show()}t.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){a(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}},this)).on("clear_search.jstree",a.proxy(function(u,t){if(this._data.search.som&&t.nodes.length){this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")}},this))};this.search=function(G,F,D,x,u,E){if(G===false||a.trim(G.toString())===""){return this.clear_search()}x=this.get_node(x);x=x&&x.id?x.id:null;G=G.toString();var C=this.settings.search,t=C.ajax?C.ajax:false,z=this._model.data,v=null,B=[],A=[],w,y;if(this._data.search.res.length&&!u){this.clear_search()}if(D===q){D=C.show_only_matches}if(E===q){E=C.show_only_matches_children}if(!F&&t!==false){if(a.isFunction(t)){return t.call(this,G,a.proxy(function(H){if(H&&H.d){H=H.d}this._load_nodes(!a.isArray(H)?[]:a.vakata.array_unique(H),function(){this.search(G,true,D,x,u)},true)},this),x)}else{t=a.extend({},t);if(!t.data){t.data={}}t.data.str=G;if(x){t.data.inside=x}return a.ajax(t).fail(a.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(t)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(a.proxy(function(H){if(H&&H.d){H=H.d}this._load_nodes(!a.isArray(H)?[]:a.vakata.array_unique(H),function(){this.search(G,true,D,x,u)},true)},this))}}if(!u){this._data.search.str=G;this._data.search.dom=a();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=D;this._data.search.smc=E}v=new a.vakata.search(G,true,{caseSensitive:C.case_sensitive,fuzzy:C.fuzzy});a.each(z[x?x:"#"].children_d,function(I,H){var J=z[H];if(J.text&&((C.search_callback&&C.search_callback.call(this,G,J))||(!C.search_callback&&v.search(J.text).isMatch))&&(!C.search_leaves_only||(J.state.loaded&&J.children.length===0))){B.push(H);A=A.concat(J.parents)}});if(B.length){A=a.vakata.array_unique(A);this._search_open(A);if(!u){this._data.search.dom=a(this.element[0].querySelectorAll("#"+a.map(B,function(H){return"0123456789".indexOf(H[0])!==-1?"\\3"+H[0]+" "+H.substr(1).replace(a.jstree.idregex,"\\$&"):H.replace(a.jstree.idregex,"\\$&")}).join(", #")));this._data.search.res=B}else{this._data.search.dom=this._data.search.dom.add(a(this.element[0].querySelectorAll("#"+a.map(B,function(H){return"0123456789".indexOf(H[0])!==-1?"\\3"+H[0]+" "+H.substr(1).replace(a.jstree.idregex,"\\$&"):H.replace(a.jstree.idregex,"\\$&")}).join(", #"))));this._data.search.res=a.vakata.array_unique(this._data.search.res.concat(B))}this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:G,res:this._data.search.res,show_only_matches:D})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");if(this.settings.search.close_opened_onclear){this.close_node(this._data.search.opn,0)}this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=a()};this._search_open=function(u){var v=this;a.each(u.concat([]),function(t,x){if(x==="#"){return true}try{x=a("#"+x.replace(a.jstree.idregex,"\\$&"),v.element)}catch(w){}if(x&&x.length){if(v.is_closed(x)){v._data.search.opn.push(x[0].id);v.open_node(x,function(){v._search_open(u)},0)}}})}};(function(r){r.vakata.search=function(y,C,x){x=x||{};x=r.extend({},r.vakata.search.defaults,x);if(x.fuzzy!==false){x.fuzzy=true}y=x.caseSensitive?y:y.toLowerCase();var u=x.location,t=x.distance,v=x.threshold,A=y.length,w,z,s,B;if(A>32){x.fuzzy=false}if(x.fuzzy){w=1<<(A-1);z=(function(){var E={},D=0;for(D=0;D<A;D++){E[y.charAt(D)]=0}for(D=0;D<A;D++){E[y.charAt(D)]|=1<<(A-D-1)}return E}());s=function(E,G){var D=E/A,F=Math.abs(u-G);if(!t){return F?1:D}return D+(F/t)}}B=function(R){R=x.caseSensitive?R:R.toLowerCase();if(y===R||R.indexOf(y)!==-1){return{isMatch:true,score:0}}if(!x.fuzzy){return{isMatch:false,score:1}}var J,K,S=R.length,P=v,D=R.indexOf(y,u),G,F,E=A+S,L,Q,I,N,H,O=1,M=[];if(D!==-1){P=Math.min(s(0,D),P);D=R.lastIndexOf(y,u+A);if(D!==-1){P=Math.min(s(0,D),P)}}D=-1;for(J=0;J<A;J++){G=0;F=E;while(G<F){if(s(J,u+F)<=P){G=F}else{E=F}F=Math.floor((E-G)/2+G)}E=F;Q=Math.max(1,u-F+1);I=Math.min(u+F,S)+A;N=new Array(I+2);N[I+1]=(1<<J)-1;for(K=I;K>=Q;K--){H=z[R.charAt(K-1)];if(J===0){N[K]=((N[K+1]<<1)|1)&H}else{N[K]=((N[K+1]<<1)|1)&H|(((L[K+1]|L[K])<<1)|1)|L[K+1]}if(N[K]&w){O=s(J,K-1);if(O<=P){P=O;D=K-1;M.push(D);if(D>u){Q=Math.max(1,2*u-D)}else{break}}}}if(s(J+1,u)>P){break}L=N}return{isMatch:D>=0,score:O}};return C===true?{search:B}:B(C)};r.vakata.search.defaults={location:0,distance:100,threshold:0.6,fuzzy:false,caseSensitive:false}}(a));a.jstree.defaults.sort=function(r,s){return this.get_text(r)>this.get_text(s)?1:-1};a.jstree.plugins.sort=function(r,s){this.bind=function(){s.bind.call(this);this.element.on("model.jstree",a.proxy(function(u,t){this.sort(t.parent,true)},this)).on("rename_node.jstree create_node.jstree",a.proxy(function(u,t){this.sort(t.parent||t.node.parent,false);this.redraw_node(t.parent||t.node.parent,true)},this)).on("move_node.jstree copy_node.jstree",a.proxy(function(u,t){this.sort(t.parent,false);this.redraw_node(t.parent,true)},this))};this.sort=function(w,t){var u,v;w=this.get_node(w);if(w&&w.children&&w.children.length){w.children.sort(a.proxy(this.settings.sort,this));if(t){for(u=0,v=w.children_d.length;u<v;u++){this.sort(w.children_d[u],false)}}}}};var p=false;a.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:false,filter:false};a.jstree.plugins.state=function(r,s){this.bind=function(){s.bind.call(this);var t=a.proxy(function(){this.element.on(this.settings.state.events,a.proxy(function(){if(p){clearTimeout(p)}p=setTimeout(a.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},this);this.element.on("ready.jstree",a.proxy(function(v,u){this.element.one("restore_state.jstree",t);if(!this.restore_state()){t()}},this))};this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+(new Date())};a.vakata.storage.set(this.settings.state.key,JSON.stringify(t))};this.restore_state=function(){var u=a.vakata.storage.get(this.settings.state.key);if(!!u){try{u=JSON.parse(u)}catch(t){return false}}if(!!u&&u.ttl&&u.sec&&+(new Date())-u.sec>u.ttl){return false}if(!!u&&u.state){u=u.state}if(!!u&&a.isFunction(this.settings.state.filter)){u=this.settings.state.filter.call(this,u)}if(!!u){this.element.one("set_state.jstree",function(w,v){v.instance.trigger("restore_state",{state:a.extend(true,{},u)})});this.set_state(u);return true}return false};this.clear_state=function(){return a.vakata.storage.del(this.settings.state.key)}};(function(r,s){r.vakata.storage={set:function(t,u){return window.localStorage.setItem(t,u)},get:function(t){return window.localStorage.getItem(t)},del:function(t){return window.localStorage.removeItem(t)}}}(a));a.jstree.defaults.types={"#":{},"default":{}};a.jstree.plugins.types=function(r,s){this.init=function(t,w){var u,v;if(w&&w.types&&w.types["default"]){for(u in w.types){if(u!=="default"&&u!=="#"&&w.types.hasOwnProperty(u)){for(v in w.types["default"]){if(w.types["default"].hasOwnProperty(v)&&w.types[u][v]===q){w.types[u][v]=w.types["default"][v]}}}}}s.init.call(this,t,w);this._model.data["#"].type="#"};this.refresh=function(u,t){s.refresh.call(this,u,t);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",a.proxy(function(x,v){var A=this._model.data,w=v.nodes,B=this.settings.types,y,z,u="default";for(y=0,z=w.length;y<z;y++){u="default";if(A[w[y]].original&&A[w[y]].original.type&&B[A[w[y]].original.type]){u=A[w[y]].original.type}if(A[w[y]].data&&A[w[y]].data.jstree&&A[w[y]].data.jstree.type&&B[A[w[y]].data.jstree.type]){u=A[w[y]].data.jstree.type}A[w[y]].type=u;if(A[w[y]].icon===true&&B[u].icon!==q){A[w[y]].icon=B[u].icon}}A["#"].type="#"},this));s.bind.call(this)};this.get_json=function(x,z,t){var u,v,w=this._model.data,y=z?a.extend(true,{},z,{no_id:false}):{},A=s.get_json.call(this,x,y,t);if(A===false){return false}if(a.isArray(A)){for(u=0,v=A.length;u<v;u++){A[u].type=A[u].id&&w[A[u].id]&&w[A[u].id].type?w[A[u].id].type:"default";if(z&&z.no_id){delete A[u].id;if(A[u].li_attr&&A[u].li_attr.id){delete A[u].li_attr.id}if(A[u].a_attr&&A[u].a_attr.id){delete A[u].a_attr.id}}}}else{A.type=A.id&&w[A.id]&&w[A.id].type?w[A.id].type:"default";if(z&&z.no_id){A=this._delete_ids(A)}}return A};this._delete_ids=function(v){if(a.isArray(v)){for(var t=0,u=v.length;t<u;t++){v[t]=this._delete_ids(v[t])}return v}delete v.id;if(v.li_attr&&v.li_attr.id){delete v.li_attr.id}if(v.a_attr&&v.a_attr.id){delete v.a_attr.id}if(v.children&&a.isArray(v.children)){v.children=this._delete_ids(v.children)}return v};this.check=function(t,z,A,B,y){if(s.check.call(this,t,z,A,B,y)===false){return false}z=z&&z.id?z:this.get_node(z);A=A&&A.id?A:this.get_node(A);var x=z&&z.id?(y&&y.origin?y.origin:a.jstree.reference(z.id)):null,C,u,v,w;x=x&&x._model&&x._model.data?x._model.data:null;switch(t){case"create_node":case"move_node":case"copy_node":if(t!=="move_node"||a.inArray(z.id,A.children)===-1){C=this.get_rules(A);if(C.max_children!==q&&C.max_children!==-1&&C.max_children===A.children.length){this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+t,data:JSON.stringify({chk:t,pos:B,obj:z&&z.id?z.id:false,par:A&&A.id?A.id:false})};return false}if(C.valid_children!==q&&C.valid_children!==-1&&a.inArray((z.type||"default"),C.valid_children)===-1){this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+t,data:JSON.stringify({chk:t,pos:B,obj:z&&z.id?z.id:false,par:A&&A.id?A.id:false})};return false}if(x&&z.children_d&&z.parents){u=0;for(v=0,w=z.children_d.length;v<w;v++){u=Math.max(u,x[z.children_d[v]].parents.length)}u=u-z.parents.length+1}if(u<=0||u===q){u=1}do{if(C.max_depth!==q&&C.max_depth!==-1&&C.max_depth<u){this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+t,data:JSON.stringify({chk:t,pos:B,obj:z&&z.id?z.id:false,par:A&&A.id?A.id:false})};return false}A=this.get_node(A.parent);C=this.get_rules(A);u++}while(A)}break}return true};this.get_rules=function(t){t=this.get_node(t);if(!t){return false}var u=this.get_type(t,true);if(u.max_depth===q){u.max_depth=-1}if(u.max_children===q){u.max_children=-1}if(u.valid_children===q){u.valid_children=-1}return u};this.get_type=function(t,u){t=this.get_node(t);return(!t)?false:(u?a.extend({type:t.type},this.settings.types[t.type]):t.type)};this.set_type=function(u,A){var x,y,z,w,v;if(a.isArray(u)){u=u.slice();for(y=0,z=u.length;y<z;y++){this.set_type(u[y],A)}return true}x=this.settings.types;u=this.get_node(u);if(!x[A]||!u){return false}w=u.type;v=this.get_icon(u);u.type=A;if(v===true||(x[w]&&x[w].icon!==q&&v===x[w].icon)){this.set_icon(u,x[A].icon!==q?x[A].icon:true)}return true}};a.jstree.defaults.unique={case_sensitive:false,duplicate:function(s,r){return s+" ("+r+")"}};a.jstree.plugins.unique=function(r,s){this.check=function(u,A,B,C,y){if(s.check.call(this,u,A,B,C,y)===false){return false}A=A&&A.id?A:this.get_node(A);B=B&&B.id?B:this.get_node(B);if(!B||!B.children){return true}var z=u==="rename_node"?C:A.text,t=[],D=this.settings.unique.case_sensitive,x=this._model.data,v,w;for(v=0,w=B.children.length;v<w;v++){t.push(D?x[B.children[v]].text:x[B.children[v]].text.toLowerCase())}if(!D){z=z.toLowerCase()}switch(u){case"delete_node":return true;case"rename_node":v=(a.inArray(z,t)===-1||(A.text&&A.text[D?"toString":"toLowerCase"]()===z));if(!v){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+z+" already exists. Preventing: "+u,data:JSON.stringify({chk:u,pos:C,obj:A&&A.id?A.id:false,par:B&&B.id?B.id:false})}}return v;case"create_node":v=(a.inArray(z,t)===-1);if(!v){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+z+" already exists. Preventing: "+u,data:JSON.stringify({chk:u,pos:C,obj:A&&A.id?A.id:false,par:B&&B.id?B.id:false})}}return v;case"copy_node":v=(a.inArray(z,t)===-1);if(!v){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+z+" already exists. Preventing: "+u,data:JSON.stringify({chk:u,pos:C,obj:A&&A.id?A.id:false,par:B&&B.id?B.id:false})}}return v;case"move_node":v=((A.parent===B.id&&(!y||!y.is_multi))||a.inArray(z,t)===-1);if(!v){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+z+" already exists. Preventing: "+u,data:JSON.stringify({chk:u,pos:C,obj:A&&A.id?A.id:false,par:B&&B.id?B.id:false})}}return v}return true};this.create_node=function(C,B,D,t,x){if(!B||B.text===q){if(C===null){C="#"}C=this.get_node(C);if(!C){return s.create_node.call(this,C,B,D,t,x)}D=D===q?"last":D;if(!D.toString().match(/^(before|after)$/)&&!x&&!this.is_loaded(C)){return s.create_node.call(this,C,B,D,t,x)}if(!B){B={}}var F,A,v,w,y,z=this._model.data,E=this.settings.unique.case_sensitive,u=this.settings.unique.duplicate;A=F=this.get_string("New node");v=[];for(w=0,y=C.children.length;w<y;w++){v.push(E?z[C.children[w]].text:z[C.children[w]].text.toLowerCase())}w=1;while(a.inArray(E?A:A.toLowerCase(),v)!==-1){A=u.call(this,F,(++w)).toString()}B.text=A}return s.create_node.call(this,C,B,D,t,x)}};var i=j.createElement("DIV");i.setAttribute("unselectable","on");i.setAttribute("role","presentation");i.className="jstree-wholerow";i.innerHTML="&#160;";a.jstree.plugins.wholerow=function(r,s){this.bind=function(){s.bind.call(this);this.element.on("ready.jstree set_state.jstree",a.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",a.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",a.proxy(function(u,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",a.proxy(function(u,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var x=false,v,w;for(v=0,w=t.selected.length;v<w;v++){x=this.get_node(t.selected[v],true);if(x&&x.length){x.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}}},this)).on("open_node.jstree",a.proxy(function(u,t){this.get_node(t.node,true).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",a.proxy(function(u,t){if(u.type==="hover_node"&&this.is_disabled(t.node)){return}this.get_node(t.node,true).children(".jstree-wholerow")[u.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",a.proxy(function(t){t.preventDefault();var u=a.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});a(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(u)},this))
/*
                 .on("mousedown.jstree touchstart.jstree", ".jstree-wholerow", function (e) {
                 if(e.target === e.currentTarget) {
                 var a = $(e.currentTarget).closest(".jstree-node").children(".jstree-anchor");
                 e.target = a[0];
                 a.trigger(e);
                 }
                 })
                 */
.on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var u=a.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});a(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(u).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",a.proxy(function(t){t.stopImmediatePropagation();var u=a.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});a(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(u).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",a.proxy(function(t){t.stopImmediatePropagation();if(!this.is_disabled(t.currentTarget)){this.hover_node(t.currentTarget)}return false},this)).on("mouseleave.jstree",".jstree-node",a.proxy(function(t){this.dehover_node(t.currentTarget)},this))};this.teardown=function(){if(this.settings.wholerow){this.element.find(".jstree-wholerow").remove()}s.teardown.call(this)};this.redraw_node=function(w,u,t,v){w=s.redraw_node.apply(this,arguments);if(w){var x=i.cloneNode(true);if(a.inArray(w.id,this._data.core.selected)!==-1){x.className+=" jstree-wholerow-clicked"}if(this._data.core.focused&&this._data.core.focused===w.id){x.className+=" jstree-wholerow-hovered"}w.insertBefore(x,w.childNodes[0])}return w}};if(j.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var r={core:{},plugins:[]},s;for(s in a.jstree.plugins){if(a.jstree.plugins.hasOwnProperty(s)&&this.attributes[s]){r.plugins.push(s);if(this.getAttribute(s)&&JSON.parse(this.getAttribute(s))){r[s]=JSON.parse(this.getAttribute(s))}}}for(s in a.jstree.defaults.core){if(a.jstree.defaults.core.hasOwnProperty(s)&&this.attributes[s]){r.core[s]=JSON.parse(this.getAttribute(s))||this.getAttribute(s)}}a(this).jstree(r)};try{j.registerElement("vakata-jstree",{prototype:m})}catch(k){}}return a.fn.jstree}));