$(function(){window.onload=window.onresize=function(){$(".nav li.active").append("<i></i>");var sidebarH=document.getElementById("sidebarNav");var contentH=document.getElementById("content");if(sidebarH.clientHeight<contentH.clientHeight){sidebarH.style.height=contentH.offsetHeight+"px"}else{contentH.style.height=sidebarH.offsetHeight+"px"}};$(".close, .btn-primary, .btn-default").click(function(){$(".dialogBox").fadeOut(500);$(".ToolTip").fadeOut(500);$("body").removeClass("modal-open")});$(".tc-close").click(function(){$(".ToolTip, .tk-wrap").remove()});$(".pzsz-content-left").hover(function(){$("#adImg, #BgImg, #zhengImg").css({"z-index":"1"});$(".saveBtn").css({"z-index":"2"})},function(){$(".saveBtn").css({"z-index":"1"});$("#adImg, #BgImg, #zhengImg").css({"z-index":"2"})})});function filesUp(id,source,url,item,bar,percent,showimg,progress,files,filetxt){var bar=$(bar);var percent=$(percent);var showimg=$(showimg);var progress=$(progress);var files=$(files);var btn=$(filetxt);$(source).wrap("<form id='"+id+"' action='"+url+"' method='post' enctype='multipart/form-data'></form>");$(source).change(function(){var imgPath=$(source).val();var strExtension=imgPath.substr(imgPath.lastIndexOf(".")+1);if(strExtension!="jpg"&&strExtension!="gif"&&strExtension!="png"&&strExtension!="bmp"){alert("请选择图片文件");return}$("#"+id).ajaxSubmit({dataType:"json",beforeSend:function(){showimg.empty();progress.show();var percentVal="0%";bar.width(percentVal);percent.html(percentVal);btn.html("上传中...")},uploadProgress:function(event,position,total,percentComplete){var percentVal=percentComplete+"%";bar.width(percentVal);percent.html(percentVal)},success:function(data){var img=data.pic;showimg.html("<img src='"+img+"'><input type='hidden' name='"+item+"' value= '"+img+"' />");btn.html("上传完成")},error:function(xhr){btn.html("上传失败");bar.width("0");files.html(xhr.responseText)}})})}function doFind(postUrl,formId,locationUrl){var loading=document.getElementById("loading");$.ajax({cache:false,type:"POST",url:postUrl,data:$(formId).serialize(),beforeSend:function(XMLHttpRequest){$("body").append('<div id="loading"><div class="ToolTip">加载</div><div class="loader"></div></div>')},error:function(request){$("#loading").remove();$.alerts.okButton="确定";jAlert("您的网络不给力，请稍后再试。","提示");return false},success:function(json){$("#loading").remove();if(json.status==1){if(locationUrl=="reload"){window.location.reload()}else{if(json.status==""){return true}else{window.location.href=locationUrl}}}else{$.alerts.okButton="确定";jAlert(json.message,"提示");return false}}})}function searchOnblur(){document.getElementById("searClk").click()}function searchKey(){if(event.keyCode==13){document.getElementById("searClk").click()}}function addTabletree(treeUrl,treeID){$.ajax({type:"get",url:"",async:false,success:function(data){$(".tree").append('<tr class="treegrid-1">'+"<td>name</td>"+"<td>操作</td>"+"</tr>")}})}function Preview(tcUrl){var str='<div class="ToolTip"></div>'+'<div class="tk-wrap">'+'<div class="tc-close" onclick="close0()"></div>'+'<div class="tk-content1">'+'<iframe src="'+tcUrl+'" width="100%" height="100%"></iframe>'+"</div>"+"</div>";$("body").append(str)}function close0(){$(".ToolTip, .tk-wrap").remove()}var adImg=new Image(),bgImg=new Image(),ckImg=new Image(),zhengImg=new Image(),endImgAd=document.getElementById("adImg"),endImgBg=document.getElementById("BgImg"),endImgZh=document.getElementById("zhengImg");var sx=$("#sx").val();if(sx==3){adImg.onload=function(){drawImgAd()};bgImg.onload=function(){drawImgBg()}}else{zhengImg.onload=function(){drawImgZh()}}$("#ad").on("change",function(e){var file=this.files[0];if(file){var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(){ckImg.src=$("#adBase64").val(reader.result).val();var Imgwidth=ckImg.width;var Imgheight=ckImg.height;if(!((630<Imgwidth)&&(Imgwidth<650))||!((330<Imgheight)&&(Imgheight<350))){$.alerts.okButton="确定";jAlert("请上传640*344像素的广告图！","提示");return}adImg.src=$("#adBase64").val(reader.result).val();e.target.value=null}}else{return}});$("#bg").on("change",function(e){var file=this.files[0];if(file){var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(){ckImg.src=$("#bgBase64").val(reader.result).val();var Imgwidth=ckImg.width;var Imgheight=ckImg.height;if(!((630<Imgwidth)&&(Imgwidth<650))||!((610<Imgheight)&&(Imgheight<620))){$.alerts.okButton="确定";jAlert("请上传640*616像素的背景图！","提示");return}bgImg.src=$("#bgBase64").val(reader.result).val();e.target.value=null}}else{return}});$("#zheng").on("change",function(e){var file=this.files[0];if(file){var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(){ckImg.src=$("#zhengBase64").val(reader.result).val();var Imgwidth=ckImg.width;var Imgheight=ckImg.height;if(!((630<Imgwidth)&&(Imgwidth<650))||!((950<Imgheight)&&(Imgheight<970))){$.alerts.okButton="确定";jAlert("请上传640*960像素的背景图！","提示");return}zhengImg.src=$("#zhengBase64").val(reader.result).val();e.target.value=null}}else{return}});function drawImgAd(){var c=document.createElement("canvas");
c.width=640;c.height=344;var cxt=c.getContext("2d");cxt.drawImage(adImg,0,0,640,344);var value=c.toDataURL("image/png");endImgAd.src=value}function drawImgBg(){var c=document.createElement("canvas");c.width=640;c.height=616;var cxt=c.getContext("2d");cxt.drawImage(bgImg,0,0,640,616);var value=c.toDataURL("image/png");endImgBg.src=value}function drawImgZh(){var c=document.createElement("canvas");c.width=640;c.height=960;var cxt=c.getContext("2d");cxt.drawImage(zhengImg,0,0,640,960);var value=c.toDataURL("image/png");endImgZh.src=value}$("#tcBtn").click(function(){$("body").append('<div id="loading"><div class="ToolTip">加载</div><div class="loader"></div></div>')});